# Build the Hermes binary in release mode
build-hermes:
    #!/usr/bin/env bash
    set -euo pipefail
    
    echo "ğŸ”¨ Building Hermes binary..."
    cd ../
    cargo build --release
    echo "âœ… Hermes build complete!"

# Build and package the Athena HTTP proxy component
build-athena:
    #!/usr/bin/env bash
    set -euo pipefail
    
    echo "ğŸ”¨ Building HTTP proxy WASM component..."
    earthly --secret GITHUB_TOKEN={{env_var('GITHUB_TOKEN')}} +build
    
    echo "ğŸ“¦ Packaging module..."
    ../target/release/hermes module package athena/manifest_module.json
    
    echo "ğŸ“¦ Packaging application..."
    ../target/release/hermes app package athena/manifest_app.json
    
    echo "âœ… Build and packaging complete!"

# Run the Athena application using release binary
run-athena:
    #!/usr/bin/env bash
    set -euo pipefail
    
    echo "ğŸš€ Running Athena application..."
    ../target/release/hermes run --untrusted athena/app.happ

# Build Hermes and then build Athena component
build-all: build-hermes build-athena

# Build everything and run Athena
run-all: build-all run-athena