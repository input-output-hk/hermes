VERSION 0.8

IMPORT ../../../../ AS hermes
IMPORT ../../../../../wasm/wasi AS wasi
IMPORT ../.. AS athena

build-staked-ada:
    DO athena+BUILD_ATHENA_COMPONENT --out=staked_ada.wasm

local-build-staked-ada:
    FROM alpine
    COPY +build-staked-ada/staked_ada.wasm .

    # Copy module configuration and metadata files
    COPY lib/config.schema.json .
    COPY lib/manifest_module.json .
    COPY lib/metadata.json .
    COPY lib/settings.schema.json .

    # Create the missing config.json file (empty JSON object)
    RUN echo '{}' > config.json

    # Create staging directory structure
    RUN mkdir -p /staging/

    # Copy WASM module and JSON config files to root of staging
    RUN cp staked_ada.wasm /staging/
    RUN cp *.json /staging/ || true

    # Export build artifacts from staging directory
    SAVE ARTIFACT /staging AS LOCAL lib