
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="The Project Catalyst Team">
      
      
        <link rel="canonical" href="https://input-output-hk.github.io/hermes/architecture/08_concepts/document_sync/protocol_spec/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../runtime_extension_spec/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>IPFS Document Sync Protocol — Specification (Draft) - Project Catalyst - Hermes</title>
      
    
    

      <link rel="stylesheet" href="../../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


  
  
    
    
      
    
    
  
    
    
      
    
    
  
    
    
      
    
    
  
    
    
      
    
    
  
    
    
      
    
    
  
    
    
      
    
    
  
    
    
      
    
    
  
    
    
      
    
    
  
    
    
      
    
    
  
    
    
      
    
    
  
    
    
      
    
    
  
    
    
      
    
    
  
  
  <style>:root{.md-tag.md-tag--html{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20384%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22m0%2032%2034.9%20395.8L191.5%20480l157.6-52.2L384%2032zm308.2%20127.9H124.4l4.1%2049.4h175.6l-13.6%20148.4-97.9%2027v.3h-1.1l-98.7-27.3-6-75.8h47.7L138%20320l53.5%2014.5%2053.7-14.5%206-62.2H84.3L71.5%20112.2h241.1z%22/%3E%3C/svg%3E');}.md-tag.md-tag--js{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M0%2032v448h448V32zm243.8%20349.4c0%2043.6-25.6%2063.5-62.9%2063.5-33.7%200-53.2-17.4-63.2-38.5l34.3-20.7c6.6%2011.7%2012.6%2021.6%2027.1%2021.6%2013.8%200%2022.6-5.4%2022.6-26.5V237.7h42.1zm99.6%2063.5c-39.1%200-64.4-18.6-76.7-43l34.3-19.8c9%2014.7%2020.8%2025.6%2041.5%2025.6%2017.4%200%2028.6-8.7%2028.6-20.8%200-14.4-11.4-19.5-30.7-28l-10.5-4.5c-30.4-12.9-50.5-29.2-50.5-63.5%200-31.6%2024.1-55.6%2061.6-55.6%2026.8%200%2046%209.3%2059.8%2033.7L368%20290c-7.2-12.9-15-18-27.1-18-12.3%200-20.1%207.8-20.1%2018%200%2012.6%207.8%2017.7%2025.9%2025.6l10.5%204.5c35.8%2015.3%2055.9%2031%2055.9%2066.2%200%2037.8-29.8%2058.6-69.7%2058.6%22/%3E%3C/svg%3E');}.md-tag.md-tag--css{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22m480%2032-64%20368-223.3%2080L0%20400l19.6-94.8h82l-8%2040.6L210%20390.2l134.1-44.4%2018.8-97.1H29.5l16-82h333.7l10.5-52.7H56.3l16.3-82z%22/%3E%3C/svg%3E');}.md-tag.md-tag--rust{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22m23.835%2011.703-1.008-.623-.028-.294.866-.807a.348.348%200%200%200-.116-.578l-1.106-.414a9%209%200%200%200-.087-.285l.69-.96a.346.346%200%200%200-.226-.544l-1.166-.19a9%209%200%200%200-.14-.261l.49-1.076a.34.34%200%200%200-.028-.336.35.35%200%200%200-.3-.154l-1.185.041a7%207%200%200%200-.188-.227l.273-1.153a.347.347%200%200%200-.417-.417l-1.153.273-.228-.188.041-1.184a.344.344%200%200%200-.49-.328l-1.076.49-.262-.14-.19-1.167a.348.348%200%200%200-.545-.226l-.96.69a9%209%200%200%200-.285-.086L14.597.453a.348.348%200%200%200-.578-.116l-.807.867a9%209%200%200%200-.294-.028L12.295.168a.346.346%200%200%200-.59%200l-.623%201.008-.294.028L9.98.337a.346.346%200%200%200-.578.116l-.414%201.106-.285.086-.959-.69a.348.348%200%200%200-.545.226l-.19%201.167a9%209%200%200%200-.262.14l-1.076-.49a.346.346%200%200%200-.49.328l.041%201.184a8%208%200%200%200-.228.187l-1.153-.272a.347.347%200%200%200-.417.417l.271%201.153-.186.227-1.184-.042a.346.346%200%200%200-.328.49l.49%201.077a9%209%200%200%200-.14.262l-1.166.19a.348.348%200%200%200-.226.544l.69.958-.087.286-1.106.414a.348.348%200%200%200-.116.578l.866.807a9%209%200%200%200-.028.294l-1.008.623a.344.344%200%200%200%200%20.59l1.008.623q.012.147.028.294l-.866.807a.346.346%200%200%200%20.116.578l1.106.415q.042.144.087.285l-.69.959a.345.345%200%200%200%20.227.544l1.166.19q.069.132.14.262l-.49%201.076a.346.346%200%200%200%20.328.49l1.183-.041q.093.115.187.227l-.27%201.154a.346.346%200%200%200%20.416.417l1.153-.272q.113.096.228.187l-.041%201.184a.344.344%200%200%200%20.49.327l1.076-.49q.13.073.262.14l.19%201.167a.348.348%200%200%200%20.545.227l.959-.69a9%209%200%200%200%20.285.086l.414%201.107a.345.345%200%200%200%20.578.115l.808-.865.294.03.623%201.006a.347.347%200%200%200%20.59%200l.623-1.007q.148-.013.294-.03l.807.866a.348.348%200%200%200%20.578-.115l.414-1.107a9%209%200%200%200%20.285-.087l.959.69a.345.345%200%200%200%20.545-.226l.19-1.166.262-.14%201.076.49a.347.347%200%200%200%20.49-.328l-.041-1.184a7%207%200%200%200%20.227-.187l1.153.272a.347.347%200%200%200%20.417-.416l-.272-1.155q.095-.112.187-.227l1.184.041a.344.344%200%200%200%20.328-.49l-.49-1.076q.072-.13.141-.262l1.166-.19a.348.348%200%200%200%20.226-.544l-.69-.959.087-.285%201.106-.414a.346.346%200%200%200%20.116-.579l-.866-.807q.016-.147.028-.294l1.008-.624a.344.344%200%200%200%200-.589zm-6.742%208.355a.714.714%200%200%201%20.299-1.396.714.714%200%201%201-.3%201.396zm-.342-2.314a.65.65%200%200%200-.771.5l-.358%201.669a8.7%208.7%200%200%201-3.619.78%208.7%208.7%200%200%201-3.695-.815L7.95%2018.21a.65.65%200%200%200-.772-.5l-1.473.317a9%209%200%200%201-.761-.898h7.167c.081%200%20.136-.014.136-.088v-2.536c0-.074-.054-.088-.136-.088h-2.096v-1.608h2.268c.206%200%201.106.059%201.393%201.209.09.353.288%201.504.424%201.873.134.413.683%201.238%201.268%201.238h3.572a1%201%200%200%200%20.13-.013%209%209%200%200%201-.813.952zm-9.914%202.28a.714.714%200%201%201-.3-1.396.714.714%200%200%201%20.3%201.396M4.117%208.997a.714.714%200%201%201-1.303.58.714.714%200%200%201%201.304-.58m-.834%201.981%201.534-.682a.65.65%200%200%200%20.33-.858l-.316-.715h1.244v5.602H3.567a8.8%208.8%200%200%201-.284-3.348zm6.734-.543V8.784h2.96c.153%200%201.08.177%201.08.87%200%20.574-.712.78-1.296.78zm10.757%201.486q0%20.329-.024.651h-.9c-.09%200-.127.059-.127.148v.413c0%20.973-.548%201.184-1.03%201.238-.457.052-.964-.191-1.027-.472-.27-1.518-.72-1.843-1.43-2.403.882-.56%201.799-1.386%201.799-2.492%200-1.193-.82-1.945-1.377-2.315-.783-.516-1.65-.62-1.883-.62H5.468a8.77%208.77%200%200%201%204.907-2.77l1.098%201.152a.65.65%200%200%200%20.918.02l1.227-1.173a8.78%208.78%200%200%201%206.004%204.276l-.84%201.898a.65.65%200%200%200%20.33.859l1.618.718q.042.43.042.872zm-9.3-9.6a.713.713%200%201%201%20.984%201.032.714.714%200%200%201-.984-1.031m8.339%206.71a.71.71%200%200%201%20.939-.362.714.714%200%201%201-.94.364z%22/%3E%3C/svg%3E');}.md-tag.md-tag--flutter{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M14.314%200%202.3%2012%206%2015.7%2021.684.013h-7.357zm.014%2011.072L7.857%2017.53l6.47%206.47H21.7l-6.46-6.468%206.46-6.46h-7.37z%22/%3E%3C/svg%3E');}.md-tag.md-tag--dart{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M4.105%204.105S9.158%201.58%2011.684.316a3.1%203.1%200%200%201%201.481-.315c.766.047%201.677.788%201.677.788L24%209.948v9.789h-4.263V24H9.789l-9-9C.303%2014.5%200%2013.795%200%2013.105c0-.319.18-.818.316-1.105zm.679.679v11.787c.002.543.021%201.024.498%201.508L10.204%2023h8.533v-4.263zm12.055-.678c-.899-.896-1.809-1.78-2.74-2.643-.302-.267-.567-.468-1.07-.462-.37.014-.87.195-.87.195L6.341%204.105z%22/%3E%3C/svg%3E');}.md-tag.md-tag--python{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22m14.25.18.9.2.73.26.59.3.45.32.34.34.25.34.16.33.1.3.04.26.02.2-.01.13V8.5l-.05.63-.13.55-.21.46-.26.38-.3.31-.33.25-.35.19-.35.14-.33.1-.3.07-.26.04-.21.02H8.77l-.69.05-.59.14-.5.22-.41.27-.33.32-.27.35-.2.36-.15.37-.1.35-.07.32-.04.27-.02.21v3.06H3.17l-.21-.03-.28-.07-.32-.12-.35-.18-.36-.26-.36-.36-.35-.46-.32-.59-.28-.73-.21-.88-.14-1.05-.05-1.23.06-1.22.16-1.04.24-.87.32-.71.36-.57.4-.44.42-.33.42-.24.4-.16.36-.1.32-.05.24-.01h.16l.06.01h8.16v-.83H6.18l-.01-2.75-.02-.37.05-.34.11-.31.17-.28.25-.26.31-.23.38-.2.44-.18.51-.15.58-.12.64-.1.71-.06.77-.04.84-.02%201.27.05zm-6.3%201.98-.23.33-.08.41.08.41.23.34.33.22.41.09.41-.09.33-.22.23-.34.08-.41-.08-.41-.23-.33-.33-.22-.41-.09-.41.09zm13.09%203.95.28.06.32.12.35.18.36.27.36.35.35.47.32.59.28.73.21.88.14%201.04.05%201.23-.06%201.23-.16%201.04-.24.86-.32.71-.36.57-.4.45-.42.33-.42.24-.4.16-.36.09-.32.05-.24.02-.16-.01h-8.22v.82h5.84l.01%202.76.02.36-.05.34-.11.31-.17.29-.25.25-.31.24-.38.2-.44.17-.51.15-.58.13-.64.09-.71.07-.77.04-.84.01-1.27-.04-1.07-.14-.9-.2-.73-.25-.59-.3-.45-.33-.34-.34-.25-.34-.16-.33-.1-.3-.04-.25-.02-.2.01-.13v-5.34l.05-.64.13-.54.21-.46.26-.38.3-.32.33-.24.35-.2.35-.14.33-.1.3-.06.26-.04.21-.02.13-.01h5.84l.69-.05.59-.14.5-.21.41-.28.33-.32.27-.35.2-.36.15-.36.1-.35.07-.32.04-.28.02-.21V6.07h2.09l.14.01zm-6.47%2014.25-.23.33-.08.41.08.41.23.33.33.23.41.08.41-.08.33-.23.23-.33.08-.41-.08-.41-.23-.33-.33-.23-.41-.08-.41.08z%22/%3E%3C/svg%3E');}.md-tag.md-tag--earthly{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M17%2014h2v3h3v2h-3v3h-2v-3h-3v-2h3zm3-2c0-3.36-2.07-6.23-5-7.41V5c0%201.1-.9%202-2%202h-2v2c0%20.55-.45%201-1%201H8v2h6c.5%200%20.9.35%201%20.81-1.8%201.04-3%202.98-3%205.19%200%201.5.54%202.85%201.44%203.9L12%2022C6.5%2022%202%2017.5%202%2012S6.5%202%2012%202s10%204.5%2010%2010l-.1%201.44c-.56-.48-1.2-.85-1.9-1.1zm-9%207.93V18c-1.1%200-2-.9-2-2v-1l-4.79-4.79C4.08%2010.78%204%2011.38%204%2012c0%204.08%203.06%207.44%207%207.93%22/%3E%3C/svg%3E');}.md-tag.md-tag--github{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12%20.297c-6.63%200-12%205.373-12%2012%200%205.303%203.438%209.8%208.205%2011.385.6.113.82-.258.82-.577%200-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422%2018.07%203.633%2017.7%203.633%2017.7c-1.087-.744.084-.729.084-.729%201.205.084%201.838%201.236%201.838%201.236%201.07%201.835%202.809%201.305%203.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93%200-1.31.465-2.38%201.235-3.22-.135-.303-.54-1.523.105-3.176%200%200%201.005-.322%203.3%201.23.96-.267%201.98-.399%203-.405%201.02.006%202.04.138%203%20.405%202.28-1.552%203.285-1.23%203.285-1.23.645%201.653.24%202.873.12%203.176.765.84%201.23%201.91%201.23%203.22%200%204.61-2.805%205.625-5.475%205.92.42.36.81%201.096.81%202.22%200%201.606-.015%202.896-.015%203.286%200%20.315.21.69.825.57C20.565%2022.092%2024%2017.592%2024%2012.297c0-6.627-5.373-12-12-12%22/%3E%3C/svg%3E');}.md-tag.md-tag--docker{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M13.983%2011.078h2.119a.186.186%200%200%200%20.186-.185V9.006a.186.186%200%200%200-.186-.186h-2.119a.185.185%200%200%200-.185.185v1.888c0%20.102.083.185.185.185m-2.954-5.43h2.118a.186.186%200%200%200%20.186-.186V3.574a.186.186%200%200%200-.186-.185h-2.118a.185.185%200%200%200-.185.185v1.888c0%20.102.082.185.185.185m0%202.716h2.118a.187.187%200%200%200%20.186-.186V6.29a.186.186%200%200%200-.186-.185h-2.118a.185.185%200%200%200-.185.185v1.887c0%20.102.082.185.185.186m-2.93%200h2.12a.186.186%200%200%200%20.184-.186V6.29a.185.185%200%200%200-.185-.185H8.1a.185.185%200%200%200-.185.185v1.887c0%20.102.083.185.185.186m-2.964%200h2.119a.186.186%200%200%200%20.185-.186V6.29a.185.185%200%200%200-.185-.185H5.136a.186.186%200%200%200-.186.185v1.887c0%20.102.084.185.186.186m5.893%202.715h2.118a.186.186%200%200%200%20.186-.185V9.006a.186.186%200%200%200-.186-.186h-2.118a.185.185%200%200%200-.185.185v1.888c0%20.102.082.185.185.185m-2.93%200h2.12a.185.185%200%200%200%20.184-.185V9.006a.185.185%200%200%200-.184-.186h-2.12a.185.185%200%200%200-.184.185v1.888c0%20.102.083.185.185.185m-2.964%200h2.119a.185.185%200%200%200%20.185-.185V9.006a.185.185%200%200%200-.184-.186h-2.12a.186.186%200%200%200-.186.186v1.887c0%20.102.084.185.186.185m-2.92%200h2.12a.185.185%200%200%200%20.184-.185V9.006a.185.185%200%200%200-.184-.186h-2.12a.185.185%200%200%200-.184.185v1.888c0%20.102.082.185.185.185M23.763%209.89c-.065-.051-.672-.51-1.954-.51q-.508.001-1.01.087c-.248-1.7-1.653-2.53-1.716-2.566l-.344-.199-.226.327c-.284.438-.49.922-.612%201.43-.23.97-.09%201.882.403%202.661-.595.332-1.55.413-1.744.42H.751a.75.75%200%200%200-.75.748%2011.4%2011.4%200%200%200%20.692%204.062c.545%201.428%201.355%202.48%202.41%203.124%201.18.723%203.1%201.137%205.275%201.137a15.7%2015.7%200%200%200%202.93-.266%2012.3%2012.3%200%200%200%203.823-1.389%2010.5%2010.5%200%200%200%202.61-2.136c1.252-1.418%201.998-2.997%202.553-4.4h.221c1.372%200%202.215-.549%202.68-1.009.309-.293.55-.65.707-1.046l.098-.288Z%22/%3E%3C/svg%3E');}.md-tag.md-tag--arc42{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M3%2017.25V21h3.75L17.81%209.93l-3.75-3.75zm19.61%201.11-4.25%204.25-5.2-5.2%201.77-1.77%201%201%202.47-2.48%201.42%201.42L18.36%2017l1.06%201%201.42-1.4zm-16-7.53L1.39%205.64l4.25-4.25L7.4%203.16%204.93%205.64%206%206.7l2.46-2.48%201.42%201.42-1.42%201.41%201%201zM20.71%207c.39-.39.39-1%200-1.41l-2.34-2.3c-.37-.39-1.02-.39-1.41%200l-1.84%201.83%203.75%203.75z%22/%3E%3C/svg%3E');}.md-tag.md-tag--adr{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12%205H9l4-4%204%204h-3v4.43c-.75.46-1.42%201.03-2%201.69zm-1.6%2010H8.5l-.7-2H4.6l-.7%202H2l3.2-9h2zm-3.05-3.35L6.2%208l-1.15%203.65zM23%2011l-4-4v3a6.747%206.747%200%200%200-7%206.17A3.006%203.006%200%200%200%2010.17%2020%203.006%203.006%200%200%200%2014%2021.83%203.01%203.01%200%200%200%2015.83%2018c-.3-.86-.98-1.53-1.83-1.83.47-4%204.47-4.2%204.95-4.2v3z%22/%3E%3C/svg%3E');}}</style>

    
<link rel="stylesheet" href="../../../../stylesheets/adr.css">

    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/mkdocs_d2_plugin.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }</style> <script src="../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ipfs-document-sync-protocol-specification-draft" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Project Catalyst - Hermes" class="md-header__button md-logo" aria-label="Project Catalyst - Hermes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Project Catalyst - Hermes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              IPFS Document Sync Protocol — Specification (Draft)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/input-output-hk/hermes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    input-output-hk/hermes
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../getting-started/" class="md-tabs__link">
          
  
  
    
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 2h2v20H7zm12 7-8 5.6V3.4z"/></svg>
    
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../api/" class="md-tabs__link">
          
  
  
    
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 7H5a2 2 0 0 0-2 2v8h2v-4h2v4h2V9a2 2 0 0 0-2-2m0 4H5V9h2m7-2h-4v10h2v-4h2a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2m0 4h-2V9h2m6 0v6h1v2h-4v-2h1V9h-1V7h4v2Z"/></svg>
    
  
  API

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../" class="md-tabs__link">
          
  
  
    
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.93l-3.75-3.75zm19.61 1.11-4.25 4.25-5.2-5.2 1.77-1.77 1 1 2.47-2.48 1.42 1.42L18.36 17l1.06 1 1.42-1.4zm-16-7.53L1.39 5.64l4.25-4.25L7.4 3.16 4.93 5.64 6 6.7l2.46-2.48 1.42 1.42-1.42 1.41 1 1zM20.71 7c.39-.39.39-1 0-1.41l-2.34-2.3c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75z"/></svg>
    
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../appendix/" class="md-tabs__link">
          
  
  
    
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23 18h-3v-3h-2v3h-3v2h3v3h2v-3h3M6 2a2 2 0 0 0-2 2v16c0 1.11.89 2 2 2h7.81c-.36-.62-.61-1.3-.73-2H6V4h7v5h5v4.08c.33-.05.67-.08 1-.08.34 0 .67.03 1 .08V8l-6-6M8 12v2h8v-2m-8 4v2h5v-2Z"/></svg>
    
  
  Appendix

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Project Catalyst - Hermes" class="md-nav__button md-logo" aria-label="Project Catalyst - Hermes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Project Catalyst - Hermes
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/input-output-hk/hermes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    input-output-hk/hermes
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../getting-started/" class="md-nav__link ">
              
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 2h2v20H7zm12 7-8 5.6V3.4z"/></svg>
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../getting-started/advanced/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 14.25 4.75 11H7c.25-5.61 2.39-10 5-10 2 0 3.77 2.64 4.55 6.45C20.36 8.23 23 10 23 12c0 1.83-2.17 3.43-5.4 4.3l.29-2.03C19.8 13.72 21 12.91 21 12c0-1.06-1.65-2-4.13-2.5.08.79.13 1.63.13 2.5 0 6.08-2.24 11-5 11-1.83 0-3.43-2.17-4.3-5.4l2.03.29C10.28 19.8 11.09 21 12 21c1.66 0 3-4.03 3-9q0-1.5-.15-2.85Q13.5 9 12 9l-1.86.06.29-2.01L12 7c.87 0 1.71.05 2.5.13C14 4.65 13.06 3 12 3c-1.54 0-2.82 3.5-3 8h2.25zM14.25 16 11 19.25V17c-5.61-.25-10-2.39-10-5 0-1.83 2.17-3.43 5.4-4.3l-.29 2.03C4.2 10.28 3 11.09 3 12c0 1.54 3.5 2.82 8 3v-2.25z"/></svg>
  
  <span class="md-ellipsis">
    Advanced
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../getting-started/development/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m13.78 15.3 6 6 2.11-2.16-6-6zm3.72-5.2c-.39 0-.81-.05-1.14-.19L4.97 21.25l-2.11-2.11 7.41-7.4L8.5 9.96l-.72.7-1.45-1.41v2.86l-.7.7-3.52-3.56.7-.7h2.81l-1.4-1.41 3.56-3.56a2.976 2.976 0 0 1 4.22 0L9.89 5.74l1.41 1.4-.71.71 1.79 1.78 1.82-1.88c-.14-.33-.2-.75-.2-1.12a3.49 3.49 0 0 1 3.5-3.52c.59 0 1.11.14 1.58.42L16.41 6.2l1.5 1.5 2.67-2.67c.28.47.42.97.42 1.6 0 1.92-1.55 3.47-3.5 3.47"/></svg>
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../getting-started/quick-start/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23 8v8l-3 1-3.09-5.5c-.26-.46-.99-.23-.91.31L17 21 7 17l1.15-8.06A6.92 6.92 0 0 1 15 3h8l-1.58 2.37C22.36 5.88 23 6.86 23 8M4 5h3.58c.5-.76 1.12-1.43 1.83-2H4c-.55 0-1 .45-1 1s.45 1 1 1m1.84 6H2c-.55 0-1 .45-1 1s.45 1 1 1h3.55zM3 9h3.12l.05-.34c.08-.58.22-1.13.41-1.66H3c-.55 0-1 .45-1 1s.45 1 1 1"/></svg>
  
  <span class="md-ellipsis">
    Quick Start
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../api/" class="md-nav__link ">
              
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 7H5a2 2 0 0 0-2 2v8h2v-4h2v4h2V9a2 2 0 0 0-2-2m0 4H5V9h2m7-2h-4v10h2v-4h2a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2m0 4h-2V9h2m6 0v6h1v2h-4v-2h1V9h-1V7h4v2Z"/></svg>
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Hermes-WASI API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Hermes-WASI API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_2_1" id="__nav_2_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Hermes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_1">
            <span class="md-nav__icon md-icon"></span>
            Hermes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/wasi-hermes/hermes/binary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Binary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/wasi-hermes/hermes/cardano/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cardano
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/wasi-hermes/hermes/cbor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cbor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/wasi-hermes/hermes/cron/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cron
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/wasi-hermes/hermes/crypto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Crypto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/wasi-hermes/hermes/doc-sync/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Doc sync
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/wasi-hermes/hermes/hash/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hash
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/wasi-hermes/hermes/http-request/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Http request
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/wasi-hermes/hermes/init/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Init
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/wasi-hermes/hermes/ipfs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ipfs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/wasi-hermes/hermes/json/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Json
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/wasi-hermes/hermes/kv-store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kv store
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/wasi-hermes/hermes/localtime/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Localtime
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/wasi-hermes/hermes/logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logging
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Wasi
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            Wasi
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/wasi-hermes/wasi/cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cli
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/wasi-hermes/wasi/clock/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Clock
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/wasi-hermes/wasi/filesystem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Filesystem
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/wasi-hermes/wasi/io/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Io
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/wasi-hermes/wasi/random/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Random
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../" class="md-nav__link ">
              
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.93l-3.75-3.75zm19.61 1.11-4.25 4.25-5.2-5.2 1.77-1.77 1 1 2.47-2.48 1.42 1.42L18.36 17l1.06 1 1.42-1.4zm-16-7.53L1.39 5.64l4.25-4.25L7.4 3.16 4.93 5.64 6 6.7l2.46-2.48 1.42 1.42-1.42 1.41 1 1zM20.71 7c.39-.39.39-1 0-1.41l-2.34-2.3c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75z"/></svg>
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../01_introduction_and_goals/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.172 6.75h-1.861l-4.566 4.564a1.874 1.874 0 1 1-1.06-1.06l4.565-4.565V3.828a.94.94 0 0 1 .275-.664l1.73-1.73a.25.25 0 0 1 .25-.063c.089.026.155.1.173.191l.46 2.301 2.3.46c.09.018.164.084.19.173a.25.25 0 0 1-.062.249l-1.731 1.73a.94.94 0 0 1-.663.275"/><path d="M2.625 12A9.375 9.375 0 0 0 12 21.375 9.375 9.375 0 0 0 21.375 12c0-.898-.126-1.766-.361-2.587A.75.75 0 0 1 22.455 9c.274.954.42 1.96.42 3 0 6.006-4.869 10.875-10.875 10.875S1.125 18.006 1.125 12 5.994 1.125 12 1.125c1.015-.001 2.024.14 3 .419a.75.75 0 1 1-.413 1.442A9.4 9.4 0 0 0 12 2.625 9.375 9.375 0 0 0 2.625 12"/><path d="M7.125 12a4.874 4.874 0 1 0 9.717-.569.748.748 0 0 1 1.047-.798c.251.112.42.351.442.625a6.373 6.373 0 0 1-10.836 5.253 6.376 6.376 0 0 1 5.236-10.844.75.75 0 1 1-.17 1.49A4.876 4.876 0 0 0 7.125 12"/></svg>
  
  <span class="md-ellipsis">
    Introduction and Goals
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../02_architecture_constraints/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.24 6.76c-1.84-1.85-4.59-2.23-6.82-1.17l-.96-.96a.996.996 0 0 0-1.41 0l-.08.09C10.83 3.75 10 3 9 3c-1.1 0-2 .9-2 2 0 .09 0 .18.03.26C6.42 5.61 6 6.25 6 7c0 .46.16.87.42 1.21A.97.97 0 0 0 6 9v1.35c-2.33.82-4 3.04-4 5.65 0 3.31 2.69 6 6 6s6-2.69 6-6a5.99 5.99 0 0 0-4-5.65V9a.97.97 0 0 0-.42-.79c.26-.34.42-.75.42-1.21 0-.09 0-.18-.03-.26.18-.1.33-.24.46-.36C11.36 6.88 12 7.86 12 9v.08c.13.07.25.17.38.25.19-.42.45-.83.79-1.16a4.01 4.01 0 0 1 5.66 0 4.01 4.01 0 0 1 0 5.66c-.8.8-1.83 1.17-2.9 1.17.07.32.07.66.07 1s-.03.67-.07 1c1.57 0 3.12-.57 4.31-1.76a5.98 5.98 0 0 0 0-8.48M9 4c.55 0 1 .45 1 1 0 .33-.17.61-.42.79C9.22 5.31 8.65 5 8 5c0-.55.45-1 1-1M7.42 6.21c.36.48.93.79 1.58.79 0 .55-.45 1-1 1s-1-.45-1-1c0-.33.17-.61.42-.79M12 16c0 2.21-1.79 4-4 4s-4-1.79-4-4 1.79-4 4-4 4 1.79 4 4"/></svg>
  
  <span class="md-ellipsis">
    Architecture Constraints
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../03_system_scope_and_context/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.9 8.9-1.7 1-4-6.9 1.7-1zm-12.1-1 3 5.2 6.1-3.5-3-5.2zm1.6 4.8-2-3.5-4.3 2.5 2 3.5zm-9.3 1.9 1 1.7 2.6-1.5-1-1.7zm10-.6-.3-.4-4.3 2.5.3.4c.2.3.5.6.8.8L7 22h2l1.4-4.3h.1L12 22h2l-1.9-5.6c.5-.7.5-1.6 0-2.4"/></svg>
  
  <span class="md-ellipsis">
    System Scope and Context
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../04_solution_strategy/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m6.91 5.5 2.3 2.29-1.42 1.42-2.29-2.3-2.29 2.3-1.42-1.42 2.3-2.29-2.3-2.29 1.42-1.42 2.29 2.3 2.29-2.3 1.42 1.42m13 13-1.42-1.42-2.29 2.3-2.29-2.3-1.42 1.42 2.3 2.29-2.3 2.29 1.42 1.42 2.29-2.3 2.29 2.3 1.42-1.42-2.3-2.29m.49-11.67L17.18 11 15.6 9.73l1.17-1.5a9.08 9.08 0 0 0-6.66 5.62A4.5 4.5 0 1 1 7.5 13a4 4 0 0 1 .78.08 11.27 11.27 0 0 1 8.15-6.82L15 5.18l1.27-1.58M10 17.5A2.5 2.5 0 1 0 7.5 20a2.5 2.5 0 0 0 2.5-2.5"/></svg>
  
  <span class="md-ellipsis">
    Solution Strategy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../05_building_block_view/" class="md-nav__link ">
              
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6V5a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v1h-2V5a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v1H3v14h8.81A6.5 6.5 0 0 1 21 10.81V6m-.69 11.9a4.5 4.5 0 1 0-1.43 1.42L22 22.39 23.39 21m-6.89-3a2.5 2.5 0 1 1 2.5-2.5 2.5 2.5 0 0 1-2.5 2.5"/></svg>
  
  <span class="md-ellipsis">
    Building Blocks
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Building Blocks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../05_building_block_view/hermes_engine/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 4v2h3v2H7l-2 2v3H3v-3H1v8h2v-3h2v3h3l2 2h8v-4h2v3h3V9h-3v3h-2V8h-6V6h3V4z"/></svg>
  
  <span class="md-ellipsis">
    Hermes engine
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../06_runtime_view/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.5 5.5a2 2 0 0 0 2-2 2 2 0 0 0-2-2 2 2 0 0 0-2 2 2 2 0 0 0 2 2m-3.6 13.9 1-4.4 2.1 2v6h2v-7.5l-2.1-2 .6-3A7.3 7.3 0 0 0 22 13v-2c-1.76.03-3.4-.89-4.3-2.4l-1-1.6c-.36-.6-1-1-1.7-1-.3 0-.5.1-.8.1L9 8.3V13h2V9.6l1.8-.7-1.6 8.1-4.9-1-.4 2zM4 9a1 1 0 0 1-1-1 1 1 0 0 1 1-1h3v2zm1-4a1 1 0 0 1-1-1 1 1 0 0 1 1-1h5v2zm-2 8a1 1 0 0 1-1-1 1 1 0 0 1 1-1h4v2z"/></svg>
  
  <span class="md-ellipsis">
    Runtime View
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../07_deployment_view/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 19h1a1 1 0 0 1 1 1h7v2h-7a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1H2v-2h7a1 1 0 0 1 1-1h1v-2H4a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1h-7zM4 3h16a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1m5 4h1V5H9zm0 8h1v-2H9zM5 5v2h2V5zm0 8v2h2v-2z"/></svg>
  
  <span class="md-ellipsis">
    Deployment View
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_9" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.5 19A1.5 1.5 0 0 1 5 20.5 1.5 1.5 0 0 1 3.5 22 1.5 1.5 0 0 1 2 20.5 1.5 1.5 0 0 1 3.5 19m5-3a2.5 2.5 0 0 1 2.5 2.5A2.5 2.5 0 0 1 8.5 21 2.5 2.5 0 0 1 6 18.5 2.5 2.5 0 0 1 8.5 16m6-1c-1.19 0-2.27-.5-3-1.35-.73.85-1.81 1.35-3 1.35-1.96 0-3.59-1.41-3.93-3.26A4.02 4.02 0 0 1 2 8a4 4 0 0 1 4-4c.26 0 .5.03.77.07C7.5 3.41 8.45 3 9.5 3c1.19 0 2.27.5 3 1.35.73-.85 1.81-1.35 3-1.35 1.96 0 3.59 1.41 3.93 3.26A4.02 4.02 0 0 1 22 10a4 4 0 0 1-4 4l-.77-.07c-.73.66-1.68 1.07-2.73 1.07"/></svg>
  
  <span class="md-ellipsis">
    Cross-cutting Concepts
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_9" id="__nav_3_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_9">
            <span class="md-nav__icon md-icon"></span>
            Cross-cutting Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../event_model/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 2v6H2V2zM2 22v-6h2v6zm3-10c0 1.11-.89 2-2 2a2 2 0 1 1 2-2m19-6v12c0 1.11-.89 2-2 2H10a2 2 0 0 1-2-2v-4l-2-2 2-2V6a2 2 0 0 1 2-2h12c1.11 0 2 .89 2 2"/></svg>
  
  <span class="md-ellipsis">
    Event Model and Concurrency
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../runtime_extensions/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.5 11H19V7a2 2 0 0 0-2-2h-4V3.5A2.5 2.5 0 0 0 10.5 1 2.5 2.5 0 0 0 8 3.5V5H4a2 2 0 0 0-2 2v3.8h1.5c1.5 0 2.7 1.2 2.7 2.7S5 16.2 3.5 16.2H2V20a2 2 0 0 0 2 2h3.8v-1.5c0-1.5 1.2-2.7 2.7-2.7s2.7 1.2 2.7 2.7V22H17a2 2 0 0 0 2-2v-4h1.5a2.5 2.5 0 0 0 2.5-2.5 2.5 2.5 0 0 0-2.5-2.5"/></svg>
  
  <span class="md-ellipsis">
    Runtime Extensions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../http_gateway/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 6v5H7V7H5v4H3V9H1v12h2v-2h2v2h2v-2h2v2h2v-2h2v2h2v-2h2v2h2v-2h2v2h2V9h-2v2h-2V7h-2v4h-2V6h-2v5h-2V6zm-6 7h2v4H3zm4 0h2v4H7zm4 0h2v4h-2zm4 0h2v4h-2zm4 0h2v4h-2z"/></svg>
  
  <span class="md-ellipsis">
    HTTP Gateway
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vfs/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20H4a2 2 0 0 1-2-2V6c0-1.11.89-2 2-2h6l2 2h8a2 2 0 0 1 2 2v3.04A4.9 4.9 0 0 0 19 10c-2.6 0-4.8 2.06-4.8 4.5v.24c-.7.6-1.2 1.5-1.2 2.46zm10-2.7v3.5c0 .6-.6 1.2-1.3 1.2h-5.5c-.6 0-1.2-.6-1.2-1.3v-3.5c0-.6.6-1.2 1.2-1.2v-1.5c0-1.4 1.4-2.5 2.8-2.5s2.8 1.1 2.8 2.5V16c.6 0 1.2.6 1.2 1.3m-2.5-2.8c0-.8-.7-1.3-1.5-1.3s-1.5.5-1.5 1.3V16h3z"/></svg>
  
  <span class="md-ellipsis">
    Virtual Filesystem (VFS)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ipfs/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15 12c0-1.3-.84-2.4-2-2.82V6.82C14.16 6.4 15 5.3 15 4a3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 1.3.84 2.4 2 2.82v2.37C9.84 9.6 9 10.7 9 12s.84 2.4 2 2.82v2.36C9.84 17.6 9 18.7 9 20a3 3 0 0 0 3 3 3 3 0 0 0 3-3c0-1.3-.84-2.4-2-2.82v-2.36c1.16-.42 2-1.52 2-2.82m-3-9a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1m0 18a1 1 0 0 1-1-1 1 1 0 0 1 1-1 1 1 0 0 1 1 1 1 1 0 0 1-1 1"/></svg>
  
  <span class="md-ellipsis">
    IPFS / libp2p
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../catalyst_mvp/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 13h-.68l-2 2h1.91L19 17H5l1.78-2h2.05l-2-2H6l-3 3v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4zm-1-5.05-4.95 4.95L8.5 9.36l4.96-4.95zm-4.24-5.66L6.39 8.66a.996.996 0 0 0 0 1.41L11.34 15c.39.41 1.02.41 1.41 0l6.36-6.34a.996.996 0 0 0 0-1.41L14.16 2.3a.975.975 0 0 0-1.4-.01"/></svg>
  
  <span class="md-ellipsis">
    Athena (Catalyst MVP) on Hermes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_9_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hermes_runtime_engine/" class="md-nav__link ">
              
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 15.5A3.5 3.5 0 0 1 8.5 12 3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97s-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1s.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64z"/></svg>
  
  <span class="md-ellipsis">
    Hermes Runtime Engine
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_9_7" id="__nav_3_9_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_9_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_9_7">
            <span class="md-nav__icon md-icon"></span>
            Hermes Runtime Engine
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hermes_runtime_engine/hre_structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HRE structure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hermes_runtime_engine/hre_state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HRE state management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hermes_runtime_engine/hre_init_setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HRE initial setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hermes_runtime_engine/h_app_struct/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hermes application structure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hermes_runtime_engine/h_app_exec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hermes application execution
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hermes_runtime_engine/h_events_queue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hermes events queue implementation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hermes_runtime_engine/wasm_parallel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WASM execution parallelization
    
  </span>
  

      </a>
    </li>
  

              
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_9_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hermes_packaging_requirements/" class="md-nav__link ">
              
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.16.12-.36.18-.57.18s-.41-.06-.57-.18l-7.9-4.44A.99.99 0 0 1 3 16.5v-9c0-.38.21-.71.53-.88l7.9-4.44c.16-.12.36-.18.57-.18s.41.06.57.18l7.9 4.44c.32.17.53.5.53.88zM12 4.15l-1.89 1.07L16 8.61l1.96-1.11zM6.04 7.5 12 10.85l1.96-1.1-5.88-3.4zM5 15.91l6 3.38v-6.71L5 9.21zm14 0v-6.7l-6 3.37v6.71z"/></svg>
  
  <span class="md-ellipsis">
    Hermes Application Packaging Requirements
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_9_8" id="__nav_3_9_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_9_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_9_8">
            <span class="md-nav__icon md-icon"></span>
            Hermes Application Packaging Requirements
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hermes_packaging_requirements/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hermes_packaging_requirements/app_package/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Packaging A Hermes Application
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hermes_packaging_requirements/app_metadata/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Application Metadata
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hermes_packaging_requirements/app_srv_www/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTTP Served Application Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hermes_packaging_requirements/app_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hermes Application Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hermes_packaging_requirements/wasm_modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Packaging WebAssembly (WASM) modules in a Hermes Application
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hermes_packaging_requirements/app_signatures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hermes Application Signatures
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hermes_packaging_requirements/app_loading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The Application Loading Process
    
  </span>
  

      </a>
    </li>
  

              
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_9_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../cardano_chain_follower/" class="md-nav__link ">
              
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14c-3.36 0-4.46 1.35-4.82 2.24C9.25 16.7 10 17.76 10 19a3 3 0 0 1-3 3 3 3 0 0 1-3-3c0-1.31.83-2.42 2-2.83V7.83A2.99 2.99 0 0 1 4 5a3 3 0 0 1 3-3 3 3 0 0 1 3 3c0 1.31-.83 2.42-2 2.83v5.29c.88-.65 2.16-1.12 4-1.12 2.67 0 3.56-1.34 3.85-2.23A3.01 3.01 0 0 1 14 7a3 3 0 0 1 3-3 3 3 0 0 1 3 3c0 1.34-.88 2.5-2.09 2.86C17.65 11.29 16.68 14 13 14m-6 4a1 1 0 0 0-1 1 1 1 0 0 0 1 1 1 1 0 0 0 1-1 1 1 0 0 0-1-1M7 4a1 1 0 0 0-1 1 1 1 0 0 0 1 1 1 1 0 0 0 1-1 1 1 0 0 0-1-1m10 2a1 1 0 0 0-1 1 1 1 0 0 0 1 1 1 1 0 0 0 1-1 1 1 0 0 0-1-1"/></svg>
  
  <span class="md-ellipsis">
    Cardano Chain Follower
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_9_9" id="__nav_3_9_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_9_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_9_9">
            <span class="md-nav__icon md-icon"></span>
            Cardano Chain Follower
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cardano_chain_follower/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1. Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cardano_chain_follower/follower_instances/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cardano Chain Follower Instances
    
  </span>
  

      </a>
    </li>
  

              
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_9_10" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hermes_signing_procedure/" class="md-nav__link ">
              
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 3c-1.11 0-2 .89-2 2v10a2 2 0 0 0 2 2h8v5l3-3 3 3v-5h2a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H4m8 2 3 2 3-2v3.5l3 1.5-3 1.5V15l-3-2-3 2v-3.5L9 10l3-1.5zM4 5h5v2H4zm0 4h3v2H4zm0 4h5v2H4z"/></svg>
  
  <span class="md-ellipsis">
    Hermes Signing Procedure
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_9_10" id="__nav_3_9_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_9_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_9_10">
            <span class="md-nav__icon md-icon"></span>
            Hermes Signing Procedure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hermes_signing_procedure/certificate_and_keys/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Certificate and keys
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hermes_signing_procedure/signature_format/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Signature format
    
  </span>
  

      </a>
    </li>
  

              
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_9_11" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18a6 6 0 0 1-6-6c0-1 .25-1.97.7-2.8L5.24 7.74A7.93 7.93 0 0 0 4 12a8 8 0 0 0 8 8v3l4-4-4-4m0-11V1L8 5l4 4V6a6 6 0 0 1 6 6c0 1-.25 1.97-.7 2.8l1.46 1.46A7.93 7.93 0 0 0 20 12a8 8 0 0 0-8-8"/></svg>
  
  <span class="md-ellipsis">
    Document Synchronization
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_9_11" id="__nav_3_9_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_9_11_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_9_11">
            <span class="md-nav__icon md-icon"></span>
            Document Synchronization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm0 2h7v5h5v11H6zm2 8v2h8v-2zm0 4v2h5v-2z"/></svg>
  
  <span class="md-ellipsis">
    IPFS Document Sync Protocol — Specification (Draft)
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm0 2h7v5h5v11H6zm2 8v2h8v-2zm0 4v2h5v-2z"/></svg>
  
  <span class="md-ellipsis">
    IPFS Document Sync Protocol — Specification (Draft)
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#status" class="md-nav__link">
    <span class="md-ellipsis">
      Status
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diagram-high-level-sync-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Diagram — High-level Sync Flow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scope-and-goals" class="md-nav__link">
    <span class="md-ellipsis">
      Scope and Goals
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#non-goals" class="md-nav__link">
    <span class="md-ellipsis">
      Non-Goals
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#roles-and-entities" class="md-nav__link">
    <span class="md-ellipsis">
      Roles and Entities
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protocol-versioning-and-negotiation" class="md-nav__link">
    <span class="md-ellipsis">
      Protocol Versioning and Negotiation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transport-bindings" class="md-nav__link">
    <span class="md-ellipsis">
      Transport Bindings
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transport Bindings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-multiple-topics-help-the-system-scale" class="md-nav__link">
    <span class="md-ellipsis">
      How multiple topics help the system scale
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How multiple topics help the system scale">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diagram-topic-separation-and-qos" class="md-nav__link">
    <span class="md-ellipsis">
      Diagram — Topic Separation and QoS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#topics-and-namespacing" class="md-nav__link">
    <span class="md-ellipsis">
      Topics and Namespacing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Topics and Namespacing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sync-topic-subscription" class="md-nav__link">
    <span class="md-ellipsis">
      Sync Topic Subscription
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sync Topic Subscription">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diagram-subscribeunsubscribe-during-sync" class="md-nav__link">
    <span class="md-ellipsis">
      Diagram — Subscribe/Unsubscribe During Sync
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-model" class="md-nav__link">
    <span class="md-ellipsis">
      Message Model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Message Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#envelope-field-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      Envelope Field Definitions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagram-envelope-and-payload" class="md-nav__link">
    <span class="md-ellipsis">
      Diagram — Envelope and Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-message-envelope" class="md-nav__link">
    <span class="md-ellipsis">
      Common Message Envelope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagnostic-example-envelope-framing-only" class="md-nav__link">
    <span class="md-ellipsis">
      Diagnostic example (envelope framing only)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-types" class="md-nav__link">
    <span class="md-ellipsis">
      Message Types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Message Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#document-dissemination-shared-payload-for-new-and-dif" class="md-nav__link">
    <span class="md-ellipsis">
      Document Dissemination (shared payload for .new and .dif)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Document Dissemination (shared payload for .new and .dif)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#document-dissemination-payload-body" class="md-nav__link">
    <span class="md-ellipsis">
      Document dissemination payload-body
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Document dissemination payload-body">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cidv1-binary-encoding-poc-focus" class="md-nav__link">
    <span class="md-ellipsis">
      CIDv1 binary encoding (PoC focus)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CIDv1 binary encoding (PoC focus)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pre-publication-document-availability-check" class="md-nav__link">
    <span class="md-ellipsis">
      Pre publication document availability check
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagram-choosing-docs-vs-manifest" class="md-nav__link">
    <span class="md-ellipsis">
      Diagram — Choosing docs vs manifest
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagnostic-example-payload-body-decoded" class="md-nav__link">
    <span class="md-ellipsis">
      Diagnostic example (payload-body decoded)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#new-topic-basenew" class="md-nav__link">
    <span class="md-ellipsis">
      .new (topic &lt;base&gt;.new)
    </span>
  </a>
  
    <nav class="md-nav" aria-label=".new (topic &lt;base&gt;.new)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quietperiod-reannounce-keepalive-on-new" class="md-nav__link">
    <span class="md-ellipsis">
      Quiet‑period re‑announce (keepalive on .new)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quiet‑period re‑announce (keepalive on .new)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diagram-quietperiod-new-keepalive-triggers-reconciliation-2-peers" class="md-nav__link">
    <span class="md-ellipsis">
      Diagram — Quiet‑period .new keepalive triggers reconciliation (2 peers)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#syn-topic-basesyn" class="md-nav__link">
    <span class="md-ellipsis">
      .syn (topic &lt;base&gt;.syn)
    </span>
  </a>
  
    <nav class="md-nav" aria-label=".syn (topic &lt;base&gt;.syn)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#determining-the-number-of-prefix-entries-in-the-message" class="md-nav__link">
    <span class="md-ellipsis">
      Determining the number of prefix entries in the message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefix-depth-selection-for-bucketization" class="md-nav__link">
    <span class="md-ellipsis">
      Prefix-depth selection for bucketization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagram-sparse-merkle-tree-depth-and-headers" class="md-nav__link">
    <span class="md-ellipsis">
      Diagram — Sparse Merkle Tree Depth and Headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cddl-syn-payload-body" class="md-nav__link">
    <span class="md-ellipsis">
      CDDL — .syn payload-body
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dif-topic-basedif" class="md-nav__link">
    <span class="md-ellipsis">
      .dif (topic &lt;base&gt;.dif)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prv-topic-baseprv-optional" class="md-nav__link">
    <span class="md-ellipsis">
      .prv (topic &lt;base&gt;.prv, OPTIONAL)
    </span>
  </a>
  
    <nav class="md-nav" aria-label=".prv (topic &lt;base&gt;.prv, OPTIONAL)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prv-processing" class="md-nav__link">
    <span class="md-ellipsis">
      .prv Processing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cddl-prv-payload-body" class="md-nav__link">
    <span class="md-ellipsis">
      CDDL — .prv payload-body
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagnostic-example-payload-body-decoded_1" class="md-nav__link">
    <span class="md-ellipsis">
      Diagnostic example (payload-body decoded)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prf-topic-baseprf-optional" class="md-nav__link">
    <span class="md-ellipsis">
      .prf (topic &lt;base&gt;.prf, OPTIONAL)
    </span>
  </a>
  
    <nav class="md-nav" aria-label=".prf (topic &lt;base&gt;.prf, OPTIONAL)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cddl-prf-payload-body-and-encrypted-plaintext" class="md-nav__link">
    <span class="md-ellipsis">
      CDDL — .prf payload-body and encrypted plaintext
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proof-topics-usage-model-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Proof Topics Usage Model (Optional)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#state-machines" class="md-nav__link">
    <span class="md-ellipsis">
      State Machines
    </span>
  </a>
  
    <nav class="md-nav" aria-label="State Machines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diagram-peer-sync-state-machine-per-base" class="md-nav__link">
    <span class="md-ellipsis">
      Diagram — Peer Sync State Machine (per &lt;base&gt;)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#timers-and-retries" class="md-nav__link">
    <span class="md-ellipsis">
      Timers and Retries
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transport-and-size-limits" class="md-nav__link">
    <span class="md-ellipsis">
      Transport and Size Limits
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#smt-sparse-merkle-tree" class="md-nav__link">
    <span class="md-ellipsis">
      SMT (Sparse Merkle Tree)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SMT (Sparse Merkle Tree)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bit-ordering-and-child-semantics" class="md-nav__link">
    <span class="md-ellipsis">
      Bit Ordering and Child Semantics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagram-simplified-smt-proof-path" class="md-nav__link">
    <span class="md-ellipsis">
      Diagram — Simplified SMT Proof Path
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encrypted-proofs-mandatory-for-prf" class="md-nav__link">
    <span class="md-ellipsis">
      Encrypted Proofs (Mandatory for .prf)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Encrypted Proofs (Mandatory for .prf)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diagram-encrypted-proof-exchange-prvprf" class="md-nav__link">
    <span class="md-ellipsis">
      Diagram — Encrypted Proof Exchange (.prv/.prf)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smt-proof-encoding" class="md-nav__link">
    <span class="md-ellipsis">
      SMT Proof Encoding
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SMT Proof Encoding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cddl-smt-proofs" class="md-nav__link">
    <span class="md-ellipsis">
      CDDL — SMT proofs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diff-reconciliation" class="md-nav__link">
    <span class="md-ellipsis">
      Diff Reconciliation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Diff Reconciliation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diagram-prefix-depth-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Diagram — Prefix Depth Selection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diff-manifest-ipfs-object" class="md-nav__link">
    <span class="md-ellipsis">
      Diff Manifest (IPFS object)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Diff Manifest (IPFS object)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cddl-diff-manifest" class="md-nav__link">
    <span class="md-ellipsis">
      CDDL — Diff manifest
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-considerations-poc" class="md-nav__link">
    <span class="md-ellipsis">
      Security Considerations (PoC)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#privacy-considerations-poc" class="md-nav__link">
    <span class="md-ellipsis">
      Privacy Considerations (PoC)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#observability-and-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Observability and Metrics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interoperability" class="md-nav__link">
    <span class="md-ellipsis">
      Interoperability
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extensibility" class="md-nav__link">
    <span class="md-ellipsis">
      Extensibility
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references_1" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#open-questions" class="md-nav__link">
    <span class="md-ellipsis">
      Open Questions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#glossary" class="md-nav__link">
    <span class="md-ellipsis">
      Glossary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime_extension_spec/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.5 11H19V7a2 2 0 0 0-2-2h-4V3.5A2.5 2.5 0 0 0 10.5 1 2.5 2.5 0 0 0 8 3.5V5H4a2 2 0 0 0-2 2v3.8h1.5c1.5 0 2.7 1.2 2.7 2.7S5 16.2 3.5 16.2H2V20a2 2 0 0 0 2 2h3.8v-1.5c0-1.5 1.2-2.7 2.7-2.7s2.7 1.2 2.7 2.7V22H17a2 2 0 0 0 2-2v-4h1.5a2.5 2.5 0 0 0 2.5-2.5 2.5 2.5 0 0 0-2.5-2.5"/></svg>
  
  <span class="md-ellipsis">
    Hermes Runtime Extension: Document Sync — Specification
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_10" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../09_architecture_decisions/" class="md-nav__link ">
              
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 5H9l4-4 4 4h-3v4.43c-.75.46-1.42 1.03-2 1.69zm-1.6 10H8.5l-.7-2H4.6l-.7 2H2l3.2-9h2zm-3.05-3.35L6.2 8l-1.15 3.65zM23 11l-4-4v3a6.747 6.747 0 0 0-7 6.17A3.006 3.006 0 0 0 10.17 20 3.006 3.006 0 0 0 14 21.83 3.01 3.01 0 0 0 15.83 18c-.3-.86-.98-1.53-1.83-1.83.47-4 4.47-4.2 4.95-4.2v3z"/></svg>
  
  <span class="md-ellipsis">
    Architecture Decisions
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_10">
            <span class="md-nav__icon md-icon"></span>
            Architecture Decisions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../09_architecture_decisions/0001-arch-std/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0001 Architecture Documentation Standard
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../09_architecture_decisions/0002-adr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0002 Architecture Decision Records
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../09_architecture_decisions/0003-app-ver-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0003 Hermes runtime extensions api version control
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../09_architecture_decisions/0004-app-loading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0004 Hermes application loading procedure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../09_architecture_decisions/0005-hdf5-packaging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0005 HDF5 for Packaging and VFS Backing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../09_architecture_decisions/0006-wasm-component-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0006 WASM Component Model with Wasmtime and WIT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../09_architecture_decisions/0007-ipfs-libp2p/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0007 Embedded IPFS/libp2p for Pub/Sub, DHT, and Files
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../09_architecture_decisions/0008-cose-signing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0008 COSE Signatures over CBOR for Package Integrity
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../10_quality_requirements/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.5 13.5h2v-3h-2M18 14a1 1 0 0 1-1 1h-.75v1.5h-1.5V15H14a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1m-7 5H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11m8-5H5c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2"/></svg>
  
  <span class="md-ellipsis">
    Quality Requirements
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../11_technical_risks/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M260 12.6c0-8.3-7.6-14.5-15.5-12.1-60.9 18.8-105.1 75.8-105.1 143.1 0 25.1 6.1 48.7 17 69.5-21 1.8-42 8.2-61.5 19.5C37 266.2 10.1 332.8 24 395.1c1.9 8.4 11.4 12 18.9 7.6 5-2.9 7.6-8.6 7.1-14.4-.3-3.3-.4-6.6-.4-10.1 0-123.5 184.4-123.5 184.4 0 0 88.4-94.5 113.6-148.2 75.4-4.5-3.2-10.5-3.9-15.3-1.1-7 4.1-8.6 13.6-2.7 19.1 46.6 43.8 118 53.9 176.1 20.2 17.9-10.4 32.8-23.9 44.5-39.4 11.7 15.6 26.6 29.1 44.5 39.4 58.1 33.7 129.5 23.6 176.1-20.2 5.9-5.5 4.3-15.1-2.7-19.1-4.8-2.8-10.8-2.1-15.3 1.1-53.7 38.2-148.2 13-148.2-75.4 0-123.5 184.4-123.5 184.4 0 0 3.4-.1 6.8-.4 10.1-.5 5.8 2.1 11.5 7.1 14.4 7.4 4.3 17 .8 18.9-7.6 13.9-62.2-13-128.9-70.9-162.5-19.5-11.3-40.4-17.7-61.5-19.5 10.9-20.8 17-44.4 17-69.5 0-67.3-44.2-124.3-105.1-143.1-7.9-2.4-15.5 3.8-15.5 12.1 0 5.9 4 11 9.5 13.2 83.4 33.6 70.8 178.4-37.8 178.4s-121.4-144.8-38-178.4c5.5-2.2 9.5-7.3 9.5-13.2M248.4 288a40 40 0 1 1 80 0 40 40 0 1 1-80 0M435 317.7c-16.2 0-31.4 5.5-42.1 15-10.1 9.1-18.1 23.4-18.1 45.6 0 21.1 7.2 35 16.5 44.1 32.2-24.6 55.5-60.5 63.9-101.8-6.3-1.9-13.2-3-20.2-3zm-233 60.6c0-22.3-8-36.6-18.1-45.6-10.7-9.6-25.9-15-42.1-15-7 0-13.9 1-20.2 3 8.4 41.3 31.6 77.2 63.9 101.8 9.4-9.1 16.5-23.1 16.5-44.2M243.2 154c9 10.2 23.2 18.2 45.2 18.2s36.2-8 45.2-18.2c6.7-7.6 11.5-17.5 13.6-28.4-18.3-6.8-38.2-10.5-58.8-10.5s-40.5 3.7-58.8 10.5c2.2 10.9 6.9 20.8 13.6 28.5z"/></svg>
  
  <span class="md-ellipsis">
    Risks and Technical Debts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../12_glossary/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 14v3h-3v2h3v3h2v-3h3v-2h-3v-3m1-3v1.3c-.6-.2-1.3-.3-2-.3-1.2 0-2.4.4-3.3 1H7v-2zm-7.9 6H7v-2h5.8c-.3.6-.6 1.3-.7 2M7 7h13v2H7zM5 19h2v2H3V3h4v2H5z"/></svg>
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../appendix/" class="md-nav__link ">
              
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23 18h-3v-3h-2v3h-3v2h3v3h2v-3h3M6 2a2 2 0 0 0-2 2v16c0 1.11.89 2 2 2h7.81c-.36-.62-.61-1.3-.73-2H6V4h7v5h5v4.08c.33-.05.67-.08 1-.08.34 0 .67.03 1 .08V8l-6-6M8 12v2h8v-2m-8 4v2h5v-2Z"/></svg>
  
  <span class="md-ellipsis">
    Appendix
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Appendix
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../appendix/tags/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="m401.2 39.1 148.2 150.3c27.7 28.1 27.7 73.1 0 101.2L393 448.9c-9.3 9.4-24.5 9.5-33.9.2s-9.5-24.5-.2-33.9l156.4-158.4c9.2-9.3 9.2-24.4 0-33.7L367 72.9c-9.3-9.4-9.2-24.6.2-33.9s24.6-9.2 33.9.2zM32.1 229.5V96c0-35.3 28.7-64 64-64h133.5c17 0 33.3 6.7 45.3 18.7l144 144c25 25 25 65.5 0 90.5L285.4 418.7c-25 25-65.5 25-90.5 0l-144-144c-12-12-18.7-28.3-18.7-45.3zm144-85.5a32 32 0 1 0-64 0 32 32 0 1 0 64 0"/></svg>
  
  <span class="md-ellipsis">
    Tag Index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../appendix/important/" class="md-nav__link ">
              
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m23 12-2.44 2.78.34 3.68-3.61.82-1.89 3.18L12 21l-3.4 1.47-1.89-3.18-3.61-.82.34-3.69L1 12l2.44-2.79-.34-3.68 3.61-.81L8.6 1.54 12 3l3.4-1.46 1.89 3.18 3.61.82-.34 3.68zm-2.67 0L18.5 9.89l.24-2.79L16 6.5l-1.42-2.43L12 5.18 9.42 4.07 8 6.5l-2.74.59.24 2.79L3.67 12l1.83 2.1-.24 2.8 2.74.6 1.42 2.43L12 18.81l2.58 1.11L16 17.5l2.74-.61-.24-2.79zM11 15h2v2h-2zm0-8h2v6h-2z"/></svg>
  
  <span class="md-ellipsis">
    Important
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Important
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../appendix/important/coc/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.7 12.9 14 18.6h-2.3v-2.3l5.7-5.7zm3.4-.8c0 .3-.3.6-.6.9L20 15.5l-.9-.9 2.6-2.6-.6-.6-.7.7-2.3-2.3 2.2-2.1c.2-.2.6-.2.9 0l1.4 1.4c.2.2.2.6 0 .9-.2.2-.4.4-.4.6s.2.4.4.6c.3.3.6.6.5.9M3 20V4h7v5h5v1.5l2-2V8l-6-6H3c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2zm8-2.9c-.2 0-.4.1-.5.1L10 15H8.5l-2.1 1.7L7 14H5.5l-1 5H6l2.9-2.6.6 2.3h1l.5-.1z"/></svg>
  
  <span class="md-ellipsis">
    Coc
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../appendix/important/contributing/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.7 7c-.3.4-.7.7-.7 1s.3.6.6 1c.5.5 1 .9.9 1.4 0 .5-.5 1-1 1.5L16.4 16 15 14.7l4.2-4.2-1-1-1.4 1.4L13 7.1l4-3.8c.4-.4 1-.4 1.4 0l2.3 2.3c.4.4.4 1.1 0 1.4M3 17.2l9.6-9.6 3.7 3.8L6.8 21H3zM7 2v3h3v2H7v3H5V7H2V5h3V2z"/></svg>
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../appendix/important/license/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 10a3.04 3.04 0 0 1 3-3 3.04 3.04 0 0 1 3 3 3.04 3.04 0 0 1-3 3 3.04 3.04 0 0 1-3-3m3 9 4 1v-3.08A7.54 7.54 0 0 1 12 18a7.54 7.54 0 0 1-4-1.08V20m4-16a5.78 5.78 0 0 0-4.24 1.74A5.78 5.78 0 0 0 6 10a5.78 5.78 0 0 0 1.76 4.23A5.78 5.78 0 0 0 12 16a5.78 5.78 0 0 0 4.24-1.77A5.78 5.78 0 0 0 18 10a5.78 5.78 0 0 0-1.76-4.26A5.78 5.78 0 0 0 12 4m8 6a8 8 0 0 1-.57 2.8A7.8 7.8 0 0 1 18 15.28V23l-6-2-6 2v-7.72A7.9 7.9 0 0 1 4 10a7.68 7.68 0 0 1 2.33-5.64A7.73 7.73 0 0 1 12 2a7.73 7.73 0 0 1 5.67 2.36A7.68 7.68 0 0 1 20 10"/></svg>
  
  <span class="md-ellipsis">
    License
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../appendix/important/security/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 12h7c-.53 4.11-3.28 7.78-7 8.92zH5V6.3l7-3.11M12 1 3 5v6c0 5.55 3.84 10.73 9 12 5.16-1.27 9-6.45 9-12V5z"/></svg>
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  




  
  






<h1 id="ipfs-document-sync-protocol-specification-draft">IPFS Document Sync Protocol — Specification (Draft)<a class="headerlink" href="#ipfs-document-sync-protocol-specification-draft" title="Permanent link">&para;</a></h1>
<h2 id="status">Status<a class="headerlink" href="#status" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Stage: PoC draft</p>
</li>
<li>
<p>Version: 0.1.0 (wire format frozen per this document; numeric parameters may be tuned)</p>
</li>
</ul>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p><strong>Purpose:</strong> Efficiently synchronize a set of document CIDs across peers using
  IPFS pub/sub broadcast for announcements and manifest-based set reconciliation for divergence.</p>
<p><strong>Design:</strong> Append-only document set represented by a Sparse Merkle Tree (SMT) root.
  Three required pub/sub topics per set: <code>&lt;base&gt;.new</code>, <code>&lt;base&gt;.syn</code>, <code>&lt;base&gt;.dif</code>.
  Two optional topics for proofs: <code>&lt;base&gt;.prv</code> (proof requests) and <code>&lt;base&gt;.prf</code> (proof replies).</p>
<p><strong>Assumptions (PoC):</strong> Honest peers, no privacy, all messages publicly readable.
  All payloads use deterministic CBOR encoding with strict framing.</p>
<h3 id="diagram-high-level-sync-flow">Diagram — High-level Sync Flow<a class="headerlink" href="#diagram-high-level-sync-flow" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>sequenceDiagram
  autonumber
  participant A as Peer A
  participant D as DHT
  participant PS as IPFS PubSub
  participant B as Peer B

  A--&gt;&gt;PS: subscribed to&lt;br&gt;`&lt;base&gt;.new` + `&lt;base&gt;.syn`
  B--&gt;&gt;PS: subscribed to&lt;br&gt;`&lt;base&gt;.new` + `&lt;base&gt;.syn`

  rect rgb(245,245,245)
    Note over A: Pre-publish check for .new
    A-&gt;&gt;D: Provide(docs/manifest CIDs)
    A-&gt;&gt;D: FindProviders(CID)
    D--&gt;&gt;A: provider ≠ A (OK)
  end
  Note over A: Broadcast on&lt;br&gt;&lt;base&gt;.new
  A-&gt;&gt;PS: .new [docs/manifest, root, count]
  PS--&gt;&gt;B: .new
  B-&gt;&gt;B: fetch+pin, update SMT (root_B)

  alt roots differ
    Note over B: Broadcast on&lt;br&gt;`&lt;base&gt;.syn`
    B--&gt;&gt;PS: subscribe to `&lt;base&gt;.dif` during reconciling
    B-&gt;&gt;PS: `&lt;base&gt;.syn`&lt;br&gt;[root=B, count=B,to=A,&lt;br&gt;?prefix=B,peer_root=A, peer_count=A]
    PS--&gt;&gt;A: .syn
    A--&gt;&gt;PS: subscribed to `&lt;base&gt;.dif` during reconciling
    rect rgb(245,245,245)
      Note over A: Pre-publish check for .dif
      A-&gt;&gt;D: Provide(docs/manifest CIDs)
      A-&gt;&gt;D: FindProviders(CID)
      D--&gt;&gt;A: provider ≠ A (OK)
    end
  A-&gt;&gt;PS: .dif [in_reply_to, (docs | manifest), root_A, count_A, (+ ttl when manifest)]
    A--&gt;&gt;PS: unsubscribe from `&lt;base&gt;.dif`
    PS--&gt;&gt;B: .dif
    B-&gt;&gt;B: fetch+pin, update SMT → parity
    B--&gt;&gt;PS: unsubscribe from `&lt;base&gt;.dif`
  else already at parity
    B-&gt;&gt;B: no sync needed
  end</code></pre>
<h2 id="scope-and-goals">Scope and Goals<a class="headerlink" href="#scope-and-goals" title="Permanent link">&para;</a></h2>
<ul>
<li>Ensure eventual consistency of document sets across honest peers.</li>
<li>Minimize pub/sub bandwidth via batched announcements and manifest-based diffs.</li>
<li>Idempotent processing of duplicates and replays.</li>
<li>Generic over <code>&lt;base&gt;</code> topic names; multiple sets may run in parallel.</li>
</ul>
<h2 id="non-goals">Non-Goals<a class="headerlink" href="#non-goals" title="Permanent link">&para;</a></h2>
<ul>
<li>Adversarial hardening (Sybil/DoS resistance, spam prevention).</li>
<li>Confidentiality or payload encryption.</li>
<li>Membership/admission control.</li>
</ul>
<h2 id="roles-and-entities">Roles and Entities<a class="headerlink" href="#roles-and-entities" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><strong>Peer:</strong> A participant with an IPFS/libp2p node publishing and subscribing to the three topics for a given <code>&lt;base&gt;</code>.</p>
</li>
<li>
<p><strong>Set:</strong> The document set scoped to <code>&lt;base&gt;</code>.</p>
</li>
</ul>
<h2 id="protocol-versioning-and-negotiation">Protocol Versioning and Negotiation<a class="headerlink" href="#protocol-versioning-and-negotiation" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Field <code>ver</code> within payloads carries protocol version (uint).
  This document defines <code>ver = 1</code>.</p>
</li>
<li>
<p>Implementations MUST ignore unknown optional fields; unknown critical fields MUST cause rejection.</p>
</li>
</ul>
<h2 id="transport-bindings">Transport Bindings<a class="headerlink" href="#transport-bindings" title="Permanent link">&para;</a></h2>
<p><strong>Pub/Sub:</strong> libp2p gossipsub (via IPFS pubsub).
All messages are broadcasts on the following topic designations:</p>
<ul>
<li><code>&lt;base&gt;.new</code> : announcements of new CIDs and the sender’s resulting root</li>
<li><code>&lt;base&gt;.syn</code> : synchronization solicitations for reconciliation</li>
<li><code>&lt;base&gt;.dif</code> : reconciliation replies with pointers to diff manifests or small inline lists</li>
<li><code>&lt;base&gt;.prv</code> : <em>OPTIONAL</em> requests for SMT inclusion proofs of specific CIDs</li>
<li><code>&lt;base&gt;.prf</code> : <em>OPTIONAL</em> proof replies containing SMT proofs</li>
</ul>
<p>No direct streams are required in this PoC; all reconciliation occurs on pub/sub.
The broadcast nature of Pub/Sub is utilized to improve efficiency in the sync process by
allowing all peers to observe the sync processes and preemptively update.</p>
<h3 id="how-multiple-topics-help-the-system-scale">How multiple topics help the system scale<a class="headerlink" href="#how-multiple-topics-help-the-system-scale" title="Permanent link">&para;</a></h3>
<p><strong>Processing isolation:</strong></p>
<ul>
<li><code>.new</code> is small and frequent (control-plane for appends),</li>
<li><code>.syn</code> is synchronization request control-only,</li>
<li><code>.dif</code> can be large or bursty, and</li>
<li><code>.prv/.prf</code> are occasional and ephemeral.
  Separating channels prevents heavy <code>.dif</code> traffic from delaying <code>.new</code> processing and keeps control paths fast.</li>
</ul>
<p><strong>Gossipsub performance:</strong> IPFS/libp2p maintains meshes, validation, and scoring per-topic.
  Splitting topics allows independent backpressure, scoring, and message ID de-dup caches,
  improving fairness and convergence under load.</p>
<p><strong>Selective subscription:</strong> Peers can opt out of proof traffic entirely,
  or temporarily subscribe to <code>.prf</code> only when they request a proof,
  reducing baseline bandwidth and CPU.</p>
<p><strong>Policy and rate limits:</strong> Enforce “one message kind per topic” and apply separate quotas/priorities.
  For example, prioritize <code>.new</code> over <code>.dif</code> so new content signals propagate quickly, while large diffs trickle.</p>
<p><strong>Observability:</strong> Topic-level metrics and alarms make it easy to detect misconfiguration or abuse
  (e.g., oversized <code>.dif</code> bursts) and to tune thresholds per traffic class.</p>
<p><strong>Future extensions:</strong> Per-topic admission or encryption can be added without impacting unrelated flows.</p>
<h4 id="diagram-topic-separation-and-qos">Diagram — Topic Separation and QoS<a class="headerlink" href="#diagram-topic-separation-and-qos" title="Permanent link">&para;</a></h4>
<pre class="mermaid"><code>flowchart LR
  subgraph PubSub Topics
    NEW["`&amp;ltbase&gt;.new&lt;br&gt;*small, frequent*`"]
    SYN["`&amp;ltbase&gt;.syn&lt;br&gt;*control-only*`"]
    DIF["`&amp;ltbase&gt;.dif&lt;br&gt;*large/bursty, ephemeral*`"]
    PRV["`&amp;ltbase&gt;.prv&lt;br&gt;*optional*`"]
    PRF["`&amp;ltbase&gt;.prf&lt;br&gt;*optional, ephemeral*`"]
  end

  NEW -- high priority --&gt; MeshNew[per-topic mesh + scoring]
  SYN -- high priority --&gt; MeshSyn
  DIF -.ephemeral+rate-limit .-&gt; MeshDif
  PRV -.opt-in.-&gt; MeshPrv
  PRF -.ephemeral.-&gt; MeshPrf

  MeshNew --&gt; Peers
  MeshSyn --&gt; Peers
  MeshDif --&gt; Peers
  MeshPrv --&gt; Peers
  MeshPrf --&gt; Peers</code></pre>
<h2 id="topics-and-namespacing">Topics and Namespacing<a class="headerlink" href="#topics-and-namespacing" title="Permanent link">&para;</a></h2>
<p><code>&lt;base&gt;</code> is an opaque UTF-8 string under 120 characters, defined by higher-level context.</p>
<p>Topic semantics are single-purpose: a topic MUST carry only its designated message type.
Peers MAY drop senders violating this.</p>
<p><em>Proof topics are OPTIONAL.</em>
Topics that require verifiability SHOULD additionally subscribe to <code>&lt;base&gt;.prv</code> and <code>&lt;base&gt;.prf</code>.</p>
<h3 id="sync-topic-subscription">Sync Topic Subscription<a class="headerlink" href="#sync-topic-subscription" title="Permanent link">&para;</a></h3>
<ul>
<li>Peers SHOULD always subscribe to <code>&lt;base&gt;.new</code> and <code>&lt;base&gt;.syn</code>.</li>
<li>Peers SHOULD subscribe to <code>&lt;base&gt;.dif</code> only while reconciling (Diverged/Reconciling states) and
  SHOULD unsubscribe when Stable to reduce baseline traffic.</li>
</ul>
<h4 id="diagram-subscribeunsubscribe-during-sync">Diagram — Subscribe/Unsubscribe During Sync<a class="headerlink" href="#diagram-subscribeunsubscribe-during-sync" title="Permanent link">&para;</a></h4>
<pre class="mermaid"><code>sequenceDiagram
  participant P as Peer
  participant PS as PubSub

  rect rgb(245,245,245)
    Note over P: Stable
    P-&gt;&gt;PS: sub(`&lt;base&gt;.new` + `&lt;base&gt;.syn`)
    P-x PS: (no sub to `&lt;base&gt;.dif`)
  end

  Note over P: Diverged detected
  P-&gt;&gt;PS: sub(`&lt;base&gt;.dif`)
  PS--&gt;&gt;P: .dif (responses)
  P-&gt;&gt;PS: After Backoff Timeout:&lt;br&gt;pub `&lt;base&gt;.syn`
  PS--&gt;&gt;P: .dif (responses)

  Note over P: Parity achieved
  P-&gt;&gt;PS: unsub(`&lt;base&gt;.dif`)
  P-&gt;&gt;PS: keep(`&lt;base&gt;.new`) and (`&lt;base&gt;.syn`)</code></pre>
<h2 id="message-model">Message Model<a class="headerlink" href="#message-model" title="Permanent link">&para;</a></h2>
<!-- markdownlint-disable MD033 -->
<p>Framing and Signature Envelope (matches the common envelope CDDL provided):</p>
<ul>
<li>Each message is a CBOR byte string (bstr) whose content is a CBOR array encoded deterministically:<br>
  <code>signed-payload = [ peer, seq, ver, payload, signature_bstr]</code>.</li>
<li>Signature input: computed over the deterministic CBOR encoding of the array
  <code>[peer, seq, ver, payload]</code> (the signed payload without the signature field).
  The signed payload array is then wrapped in a bstr for framing, and <code>signature_bstr</code>
  contains the Ed25519 signature over that array’s bytes.</li>
</ul>
<!-- markdownlint-enable MD033 -->

<p><strong>Rationale:</strong> Outer bstr provides explicit length framing; deterministic CBOR ensures unambiguous signing.</p>
<p><strong>Deduplication:</strong> Receivers MUST de-duplicate by <code>(peer-pubkey, seq)</code> and drop duplicates.</p>
<p><strong>Idempotence:</strong> Duplicated CIDs in <code>.new</code> are harmless; set inserts are idempotent.</p>
<h3 id="envelope-field-definitions">Envelope Field Definitions<a class="headerlink" href="#envelope-field-definitions" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>peer</strong> - The Ed25519 Public Key which matches the senders Peer ID in the IPFS Network.
  The sender’s peer ID can be derived from this public key, and MUST be valid.</li>
<li><strong>seq</strong> - Message Sequence.
   A UUIDv7 that defined both a unique Nonce, and a Timestamp.
   Prevents and helps detect message duplication.</li>
<li><strong>ver</strong> - Numeric protocol version.
   This protocol is Version 1, so this will be encoded as <code>1</code>.</li>
<li><strong>payload</strong> - The channel specific payload contained within the message.</li>
<li><strong>signature</strong> - The signature over all preceding bytes, from the bstr header to the end of the payload.
   The signature is made using the senders private ED25519 key which matches their public key.
   It is validated against the <strong>peer</strong> field at the start of the payload.</li>
</ol>
<h3 id="diagram-envelope-and-payload">Diagram — Envelope and Payload<a class="headerlink" href="#diagram-envelope-and-payload" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>---
config:
  layout: elk
---

erDiagram
  Envelope {
    bstr(82-1MiB) SignedPayload
  }

  SignedPayload {
    ed25519-pubkey(32) peer
    uuidv7(16) seq
    uint ver
    payload-body(map) payload
    ed25519-sig(64) signature
  }

  Envelope ||--|| SignedPayload : Contains
</code></pre>
<h3 id="common-message-envelope">Common Message Envelope<a class="headerlink" href="#common-message-envelope" title="Permanent link">&para;</a></h3>
<div class="language-cddl highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1">; Common Message Envelope</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="c1">; Envelope: outer bstr containing a signed CBOR payload</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nc">envelope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">bstr</span><span class="w"> </span><span class="ow">.size</span><span class="w"> </span><span class="p">(</span><span class="mi">82</span><span class="o">..</span><span class="mi">1048576</span><span class="p">)</span><span class="w"> </span><span class="ow">.cbor</span><span class="w"> </span><span class="nc">signed-payload</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="nc">signed-payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="s">peer</span><span class="p">:</span><span class="w"> </span><span class="nc">peer-pubkey</span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="s">seq</span><span class="p">:</span><span class="w"> </span><span class="nc">uuidv7</span><span class="p">,</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span><span class="s">ver</span><span class="p">:</span><span class="w"> </span><span class="nb">uint</span><span class="p">,</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="s">payload</span><span class="p">:</span><span class="w"> </span><span class="nc">payload-body</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">    </span><span class="s">signature_bstr</span><span class="p">:</span><span class="w"> </span><span class="nc">peer-sig</span><span class="w"> </span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="p">]</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="nc">uuidv7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">uuid</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="nc">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">#6.37</span><span class="p">(</span><span class="nb">bytes</span><span class="w"> </span><span class="ow">.size</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="nc">ed25519-pubkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">bytes</span><span class="w"> </span><span class="ow">.size</span><span class="w"> </span><span class="mi">32</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="nc">ed25519-sig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">bytes</span><span class="w"> </span><span class="ow">.size</span><span class="w"> </span><span class="mi">64</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="nc">peer-pubkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ed25519-pubkey</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="nc">peer-sig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ed25519-sig</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="nc">payload-body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">any</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<h3 id="diagnostic-example-envelope-framing-only">Diagnostic example (envelope framing only)<a class="headerlink" href="#diagnostic-example-envelope-framing-only" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>bstr([
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>  h&#39;aa..peer-pubkey..&#39;,   ; peer (ed25519 pubkey)
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>  h&#39;01..uuidv7..&#39;,        ; seq
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>  1,                      ; ver = 1
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>  { 1: h&#39;root..&#39;, 2: 42 },; payload-body (example for .new)
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>  h&#39;..signature..&#39;        ; peer-sig
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>])
</span></code></pre></div>
<h2 id="message-types">Message Types<a class="headerlink" href="#message-types" title="Permanent link">&para;</a></h2>
<h3 id="document-dissemination-shared-payload-for-new-and-dif">Document Dissemination (shared payload for <code>.new</code> and <code>.dif</code>)<a class="headerlink" href="#document-dissemination-shared-payload-for-new-and-dif" title="Permanent link">&para;</a></h3>
<p>This generic message describes the common payload-body used by both <code>.new</code> and <code>.dif</code>.</p>
<p>Topic-specific rules (e.g., <code>.dif</code> requiring <code>in_reply_to</code>, <code>.new</code> forbidding it) are defined in their respective sections below.</p>
<p><strong>Semantics:</strong> Announce documents and the sender’s resulting set summary.</p>
<p>Payload-body Keys:</p>
<!--markdownlint-disable MD033-->

<table>
<thead>
<tr>
<th>Index</th>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><strong>root</strong></td>
<td>root-hash</td>
<td>BLAKE3-256 of the sender’s SMT root</td>
</tr>
<tr>
<td>2</td>
<td><strong>count</strong></td>
<td>uint</td>
<td>sender’s current document count</td>
</tr>
<tr>
<td>3</td>
<td><strong>docs</strong></td>
<td>array of cidv1<br><em>OPTIONAL</em></td>
<td>inline CIDs the sender believes others may be missing (≤ 1 MiB total)</td>
</tr>
<tr>
<td>4</td>
<td><strong>manifest</strong></td>
<td>cidv1<br><em>OPTIONAL</em></td>
<td>manifest CID listing CIDs when message size would exceed 1 MiB.</td>
</tr>
<tr>
<td>5</td>
<td><strong>ttl</strong></td>
<td>uint<br>REQUIRED with manifest</td>
<td>seconds the manifest remains available.<br>The responder MUST keep the manifest block available for at least this time.<br>Present only when <code>manifest</code> is used; absent otherwise.</td>
</tr>
<tr>
<td>6</td>
<td><strong>in_reply_to</strong></td>
<td>UUIDv7</td>
<td><code>seq</code> of the <code>.syn</code> message which caused this message to be sent. (Not used in <code>.new</code>)</td>
</tr>
</tbody>
</table>
<!--markdownlint-enable MD033-->
<p>Either <strong>docs</strong> or <strong>manifest</strong> MUST be present, and only one of them may be present.</p>
<h4 id="document-dissemination-payload-body">Document dissemination payload-body<a class="headerlink" href="#document-dissemination-payload-body" title="Permanent link">&para;</a></h4>
<div class="language-cddl highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1">; Payload body fits within the Common Message Envelope</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nc">payload-body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">doc-dissemination-body</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="c1">; numeric keys (shared by .new and .dif)</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="nc">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="nc">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="nc">docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="nc">manifest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="nc">ttl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="nc">in_reply_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="nc">common-fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">    </span><span class="nc">root</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">root-hash</span><span class="p">,</span><span class="w">     </span><span class="c1">; Root of the senders SMT with these docs added.</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="nc">count</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">uint</span><span class="p">,</span><span class="w">         </span><span class="c1">; Count of the number of docs in the senders Merkle Tree.</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">    </span><span class="o">?</span><span class="w"> </span><span class="nc">in_reply_to</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">uuid</span><span class="p">,</span><span class="w"> </span><span class="c1">; Included if this is a reply to a `.syn` topic message.</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="p">)</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="nc">doc-dissemination-body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="w">    </span><span class="nc">common-fields</span><span class="p">,</span><span class="w">        </span><span class="c1">; All fields common to doc lists or doc manifests</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="w">    </span><span class="nc">docs</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="o">*</span><span class="w"> </span><span class="nc">cidv1</span><span class="p">]</span><span class="w">     </span><span class="c1">; List of CIDv1 Documents </span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="p">}</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="w">    </span><span class="nc">common-fields</span><span class="p">,</span><span class="w">        </span><span class="c1">; All fields common to doc lists or doc manifests</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">    </span><span class="nc">manifest</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">cidv1</span><span class="p">,</span><span class="w">    </span><span class="c1">; CIDv1 of a Manifest of Documents </span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="w">    </span><span class="nc">ttl</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">uint</span><span class="w">           </span><span class="c1">; How long the Manifest can be expected to be pinned by the sender.</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="p">})</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="c1">; self-contained types</span>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="nc">blake3-256</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">bytes</span><span class="w"> </span><span class="ow">.size</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="c1">; BLAKE3-256 output</span>
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a><span class="nc">root-hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">blake3-256</span><span class="w">      </span><span class="c1">; Root hash of the Sparse Merkle Tree</span>
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="nc">cidv1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">bytes</span><span class="w"> </span><span class="ow">.size</span><span class="w"> </span><span class="p">(</span><span class="mi">36</span><span class="o">..</span><span class="mi">40</span><span class="p">)</span><span class="w">  </span><span class="c1">; CIDv1 (binary); multihash MUST be sha2-256 (32-byte digest)</span>
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="nc">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">#6.37</span><span class="p">(</span><span class="nb">bytes</span><span class="w"> </span><span class="ow">.size</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="c1">; UUIDv7</span>
</span></code></pre></div>
<p><strong>Note:</strong> <em>Only CIDv1 with multihash sha2-256 is permitted for document CIDs in this PoC;
implementations MUST reject other multihash functions.</em></p>
<h5 id="cidv1-binary-encoding-poc-focus">CIDv1 binary encoding (PoC focus)<a class="headerlink" href="#cidv1-binary-encoding-poc-focus" title="Permanent link">&para;</a></h5>
<p>Layout (packed bytes): <code>cidv1 = varint(1) || varint(multicodec) || multihash</code>.</p>
<p>Multihash for this PoC MUST be sha2-256 with a 32-byte digest:</p>
<p><code>multihash = varint(0x12) || varint(32) || digest[32]</code>.</p>
<p>Length varies slightly (36..40 bytes) due to varint encoding of the multicodec field.</p>
<p>Other multihash functions are Invalid.</p>
<h6 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h6>
<ul>
<li>CIDv1 specification: <a href="https://github.com/multiformats/cid">https://github.com/multiformats/cid</a></li>
<li>Multicodec table: <a href="https://github.com/multiformats/multicodec">https://github.com/multiformats/multicodec</a></li>
<li>Multihash specification: <a href="https://github.com/multiformats/multihash">https://github.com/multiformats/multihash</a></li>
</ul>
<h5 id="pre-publication-document-availability-check">Pre publication document availability check<a class="headerlink" href="#pre-publication-document-availability-check" title="Permanent link">&para;</a></h5>
<p>Pre-publication availability check <strong>(MUST)</strong> be performed before announcing or referencing a document CID on the network
(i.e., publishing a payload on <code>.new</code>, <code>.dif</code>, or <code>.prv</code> that contains a <code>cidv1</code> either inline or via a manifest),
the publishing peer MUST ensure the CID is discoverable via the DHT by:</p>
<ol>
<li>Providing the CID (announce provider records) to the DHT, and</li>
<li>Successfully calling FindProviders(CID) and obtaining at least one provider peer ID that is NOT the publisher’s own peer ID.</li>
</ol>
<p>If this check fails, the publisher MUST retry Provide/FindProviders with backoff before sending the announcement.
For manifests, this requirement applies to the manifest CID itself and to every CID listed within the manifest.</p>
<p>Rationale: This ensures receiving peers can discover and fetch/pin the referenced content promptly after observing the announcement.</p>
<h5 id="diagram-choosing-docs-vs-manifest">Diagram — Choosing docs vs manifest<a class="headerlink" href="#diagram-choosing-docs-vs-manifest" title="Permanent link">&para;</a></h5>
<pre class="mermaid"><code>flowchart TD
  A[Start] --&gt; C{Estimated encoded size ≤ 1 MiB?}
  C -- Yes --&gt; D[Include docs inline]
  C -- No --&gt; M["Publish manifest (cidv1)"]
  M --&gt; T["Set ttl (seconds)"]
  D --&gt; P1["Provide(CID); FindProviders(CID) != self"]
  T --&gt; P2["Provide(manifest CID &amp; docs); FindProviders != self"]
  P1 --&gt; E[Send payload]
  P2 --&gt; E</code></pre>
<h4 id="diagnostic-example-payload-body-decoded">Diagnostic example (payload-body decoded)<a class="headerlink" href="#diagnostic-example-payload-body-decoded" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>{ 
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    1: h&#39;aaaa...aaaa&#39;, 
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    2: 100, 
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    3: [ 
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>        h&#39;01..cidv1&#39;, 
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>        h&#39;02..cidv1&#39; 
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    ] 
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>}
</span></code></pre></div>
<h3 id="new-topic-basenew"><code>.new</code> (topic <code>&lt;base&gt;.new</code>)<a class="headerlink" href="#new-topic-basenew" title="Permanent link">&para;</a></h3>
<p><strong>Semantics:</strong> Announce newly produced documents and proactively disseminate documents the sender believes others may be missing.</p>
<p><strong>Payload-body:</strong> Uses the shared Document Dissemination payload (see “Document Dissemination”).</p>
<p><strong>Topic rules:</strong></p>
<ul>
<li><em>in_reply_to</em> MUST NOT be present on <code>.new</code>.</li>
<li><strong>docs</strong> or <strong>manifest</strong> MUST be present (exactly one of them).
  For <code>.new</code> keepalive re‑announcements (see below),
  <strong>docs</strong> MAY be an empty array to re‑advertise the sender’s current
  <code>root</code> and <code>count</code> without pointing to any documents.</li>
<li><strong>ttl</strong> MUST be present when <code>manifest</code> is used and MUST NOT appear with inline <code>docs</code>.
  Individual announced <code>docs</code> are always pinned.</li>
</ul>
<p><strong>Processing:</strong></p>
<ol>
<li><em>Publisher precondition (MUST):</em> Prior to publishing a <code>.new</code> with any <code>cidv1</code> (inline or via manifest),
   the publisher MUST ensure each CID is discoverable via the DHT by calling Provide(CID) and then
   FindProviders(CID) and receiving at least one provider peer ID that is not the publisher’s own.
   If not satisfied, retry with backoff before publishing.
   When a manifest is used, this applies to the manifest CID itself and to every CID listed within the manifest.</li>
<li><em>Document validation:</em> Fetch and pin all CIDs from docs or manifest before insertion.</li>
<li><em>Atomic pinning:</em> if any CID cannot be fetched and pinned within the pinning retry window,
   release partial pins and defer insertion.</li>
<li><em>Recompute SMT root:</em> Upon successful pin of all CIDs, insert each CID into the local SMT; compute local root.</li>
<li><em>Verify convergence:</em> If local root ≠ sender root, mark divergence and enter reconciliation backoff (see State Machines),
   unless parity is achieved during backoff via subsequent <code>.new</code>/<code>.dif</code> reception.</li>
</ol>
<h4 id="quietperiod-reannounce-keepalive-on-new">Quiet‑period re‑announce (keepalive on <code>.new</code>)<a class="headerlink" href="#quietperiod-reannounce-keepalive-on-new" title="Permanent link">&para;</a></h4>
<p>To ensure peers can detect divergence even in prolonged steady state (no new documents),
each peer maintains a per‑channel quiet‑period timer.</p>
<p>If no <code>.new</code> messages are observed on <code>&lt;base&gt;.new</code> for the duration of this timer (with added jitter), the peer SHOULD publish a
<code>.new</code> whose <strong>docs</strong> field is present but empty (i.e., <code>[]</code>).</p>
<p>This keepalive:</p>
<ul>
<li>re‑advertises the sender’s current <code>root</code> and <code>count</code> without referencing any CIDs,</li>
<li>requires no DHT pre‑publication checks or pinning (no CIDs are announced), and</li>
<li>enables other peers to observe root mismatches and enter reconciliation.</li>
</ul>
<p>Peers MUST apply jitter to avoid synchronized bursts and SHOULD
rate‑limit keepalives (see Timers and Retries).</p>
<h5 id="diagram-quietperiod-new-keepalive-triggers-reconciliation-2-peers">Diagram — Quiet‑period <code>.new</code> keepalive triggers reconciliation (2 peers)<a class="headerlink" href="#diagram-quietperiod-new-keepalive-triggers-reconciliation-2-peers" title="Permanent link">&para;</a></h5>
<pre class="mermaid"><code>sequenceDiagram
  autonumber
  participant A as Peer A
  participant PS as IPFS PubSub
  participant B as Peer B

  Note over A,B: No `.new` observed on &lt;base&gt;.new for Tquiet
  par Independent quiet timers with jitter
    A-&gt;&gt;A: start Tquiet + jitter
    B-&gt;&gt;B: start Tquiet + jitter
  end

  Note over B: Timer fires first
  B-&gt;&gt;PS: .new [docs=[], root_B, count_B]
  PS--&gt;&gt;A: .new
  A-&gt;&gt;A: root_A ≠ root_B → Diverged
  A-&gt;&gt;PS: after backoff: .syn [root_A, count_A, to=B, ...]
  PS--&gt;&gt;B: .syn
  B-&gt;&gt;PS: .dif [in_reply_to, (docs|manifest), root_B, count_B]
  PS--&gt;&gt;A: .dif
  A-&gt;&gt;A: fetch+pin, update SMT → Stable</code></pre>
<h3 id="syn-topic-basesyn">.syn (topic <code>&lt;base&gt;.syn</code>)<a class="headerlink" href="#syn-topic-basesyn" title="Permanent link">&para;</a></h3>
<p><strong>Semantics:</strong> Solicitation for reconciliation; requests a diff from peers.</p>
<p><strong>Payload-body Keys:</strong></p>
<!--markdownlint-disable MD033-->

<table>
<thead>
<tr>
<th>Index</th>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><strong>root</strong></td>
<td>root-hash</td>
<td>BLAKE3-256 of the requester’s SMT root</td>
</tr>
<tr>
<td>2</td>
<td><strong>count</strong></td>
<td>uint</td>
<td>requester’s current document count</td>
</tr>
<tr>
<td>3</td>
<td><strong>to</strong></td>
<td>peer-pubkey</td>
<td>target peer to respond (required; hint only — other peers MAY reply)</td>
</tr>
<tr>
<td>4</td>
<td><strong>prefix</strong></td>
<td>array of prefix-hash<br><em>OPTIONAL</em></td>
<td>SMT node hashes at depth <span class="arithmatex">\(D\)</span>, left-to-right across the tree.<br>Array length MUST be a power of two (2,4,8,…,16384). Include only when count &gt; 64.</td>
</tr>
<tr>
<td>5</td>
<td><strong>peer_root</strong></td>
<td>root-hash</td>
<td>last observed SMT root of the target peer (as believed by requester)</td>
</tr>
<tr>
<td>6</td>
<td><strong>peer_count</strong></td>
<td>uint</td>
<td>last observed document count of the target peer (as believed by requester)</td>
</tr>
</tbody>
</table>
<!--markdownlint-enable MD033-->
<p><strong>Processing:</strong></p>
<ul>
<li>Any peer MAY respond if it believes it can help reconcile;
  responders SHOULD use jitter (see Timers) and suppress if a suitable <code>.dif</code> appears.</li>
<li>Observers MAY use information to converge opportunistically,
  but <code>.syn</code> does not carry updates itself.</li>
</ul>
<h4 id="determining-the-number-of-prefix-entries-in-the-message">Determining the number of <strong>prefix</strong> entries in the message<a class="headerlink" href="#determining-the-number-of-prefix-entries-in-the-message" title="Permanent link">&para;</a></h4>
<p>If there are ≤ 64 documents in the tree being solicited, then there are no <strong>prefix</strong> entries (the root suffices).
If there are &gt; 64, include a <strong>prefix</strong> array of length <span class="arithmatex">\(2^D\)</span>, where <span class="arithmatex">\(D \ge 1\)</span>.</p>
<p>Target bucket size is ~64 documents.
When total docs <span class="arithmatex">\(N\)</span> passes <span class="arithmatex">\(64\cdot 2^D\)</span>, increase depth to <span class="arithmatex">\(D+1\)</span> so the new average bucket size becomes <span class="arithmatex">\(\approx N/2^{D+1}\)</span>
(about half the previous, trending back toward 64 as documents grow).
This produces a stable oscillation between ~32 and ~64 per bucket and keeps reconciliation overhead predictable.</p>
<p><strong>Prefix Entries:</strong></p>
<p>Prefix entries are the SMT node hashes (NodeHash(left,right) with BLAKE3-256) at depth D across the tree from left to right
(hence a power-of-two count).
Each increment of D doubles the number of prefix hashes.
For message-size constraints, D MUST NOT exceed 14 (max 16384 entries); deeper arrays risk exceeding the 1 MiB limit.</p>
<p>Note: Prefix hashes are computed over the requester’s own SMT at depth <span class="arithmatex">\(D\)</span>;
responders compare these against their corresponding nodes to locate mismatches.</p>
<h4 id="prefix-depth-selection-for-bucketization">Prefix-depth selection for bucketization<a class="headerlink" href="#prefix-depth-selection-for-bucketization" title="Permanent link">&para;</a></h4>
<p>Depth <span class="arithmatex">\(d\)</span> is chosen based on the requester’s estimate of the responder’s document count <span class="arithmatex">\(N\)</span> (<strong>peer_count</strong>),
targeting <span class="arithmatex">\(\le 64\)</span> items per bucket until a maximum depth is reached:</p>
<ol>
<li>Compute <span class="arithmatex">\(d_{\mathrm{req}} = \left\lceil \log_2\!\left(\max(1, N / 64)\right) \right\rceil\)</span>.</li>
<li>Set <span class="arithmatex">\(d = \min\big(14,\; \max(1,\, d_{\mathrm{req}})\big)\)</span>.</li>
</ol>
<p>The <strong>prefix</strong> array then contains the <span class="arithmatex">\(2^d\)</span> SMT node hashes at depth <span class="arithmatex">\(d\)</span> (left→right).
Responders infer <span class="arithmatex">\(d\)</span> from the array length.</p>
<h4 id="diagram-sparse-merkle-tree-depth-and-headers">Diagram — Sparse Merkle Tree Depth and Headers<a class="headerlink" href="#diagram-sparse-merkle-tree-depth-and-headers" title="Permanent link">&para;</a></h4>
<p>The <code>.syn</code> message includes a prefix array of node hashes at depth <code>d</code> (the “headers”) to partition the tree into <code>2^d</code> buckets.
Each prefix entry is the SMT node hash <code>NodeHash(left, right)</code> at depth <code>d</code> (BLAKE3-256), ordered left-to-right across the tree.
Responders compare these headers against their own nodes at the same depth to find mismatching buckets and
then return all documents under those buckets via <code>.dif</code>.</p>
<p><span class="graphviz-light-dark" data-library-default="#789abc" data-default="#789abc" data-light="#000000" data-dark="#ffffff"></span><svg width="1243pt" height="354pt" viewBox="0.00 0.00 1243.00 354.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="graphviz dot"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 350.4)"><title>SMT</title><polygon fill="none" stroke="none" points="-4,4 -4,-350.4 1239.4,-350.4 1239.4,4 -4,4"/><!-- root --><g id="node1" class="node"><title>root</title><ellipse fill="#eef6ff" stroke="#789abc" cx="656.2" cy="-320.8" rx="21.6" ry="21.6"/><ellipse fill="none" stroke="#789abc" cx="656.2" cy="-320.8" rx="25.6" ry="25.6"/><text xml:space="preserve" text-anchor="middle" x="656.2" y="-322.95" font-family="Times,serif" font-size="8.00" fill="#789abc">Root</text><text xml:space="preserve" text-anchor="middle" x="656.2" y="-313.2" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 0)</text></g><!-- d1L --><g id="node2" class="node"><title>d1L</title><ellipse fill="none" stroke="#789abc" cx="459.2" cy="-237.6" rx="21.6" ry="21.6"/><text xml:space="preserve" text-anchor="middle" x="459.2" y="-234.88" font-family="Times,serif" font-size="8.00" fill="#789abc">d=1:L</text></g><!-- root&#45;&gt;d1L --><g id="edge1" class="edge"><title>root&#45;&gt;d1L</title><path fill="none" stroke="#789abc" d="M632.44,-310.01C596.69,-295.27 529.07,-267.4 489.72,-251.18"/><polygon fill="#789abc" stroke="#789abc" points="491.16,-247.99 480.59,-247.41 488.5,-254.46 491.16,-247.99"/></g><!-- d1R --><g id="node3" class="node"><title>d1R</title><ellipse fill="none" stroke="#789abc" cx="776.2" cy="-237.6" rx="21.6" ry="21.6"/><text xml:space="preserve" text-anchor="middle" x="776.2" y="-234.88" font-family="Times,serif" font-size="8.00" fill="#789abc">d=1:R</text></g><!-- root&#45;&gt;d1R --><g id="edge2" class="edge"><title>root&#45;&gt;d1R</title><path fill="none" stroke="#789abc" d="M677.1,-305.66C697.13,-292.1 727.46,-271.58 749.29,-256.81"/><polygon fill="#789abc" stroke="#789abc" points="751.08,-259.82 757.4,-251.32 747.16,-254.03 751.08,-259.82"/></g><!-- h0 --><g id="node4" class="node"><title>h0</title><ellipse fill="#fff4ce" stroke="#789abc" stroke-width="2" cx="223.2" cy="-158.4" rx="21.6" ry="21.6"/><text xml:space="preserve" text-anchor="middle" x="223.2" y="-160.55" font-family="Times,serif" font-size="8.00" fill="#789abc">H0</text><text xml:space="preserve" text-anchor="middle" x="223.2" y="-150.8" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 2)</text></g><!-- d1L&#45;&gt;h0 --><g id="edge3" class="edge"><title>d1L&#45;&gt;h0</title><path fill="none" stroke="#789abc" d="M438.67,-229.88C397.35,-216.37 303.91,-185.8 254.77,-169.73"/><polygon fill="#789abc" stroke="#789abc" points="255.88,-166.41 245.29,-166.63 253.71,-173.06 255.88,-166.41"/></g><!-- h1 --><g id="node5" class="node"><title>h1</title><ellipse fill="#fff4ce" stroke="#789abc" stroke-width="2" cx="459.2" cy="-158.4" rx="21.6" ry="21.6"/><text xml:space="preserve" text-anchor="middle" x="459.2" y="-160.55" font-family="Times,serif" font-size="8.00" fill="#789abc">H1</text><text xml:space="preserve" text-anchor="middle" x="459.2" y="-150.8" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 2)</text></g><!-- d1L&#45;&gt;h1 --><g id="edge4" class="edge"><title>d1L&#45;&gt;h1</title><path fill="none" stroke="#789abc" d="M459.2,-215.5C459.2,-208.19 459.2,-199.8 459.2,-191.79"/><polygon fill="#789abc" stroke="#789abc" points="462.7,-191.98 459.2,-181.98 455.7,-191.98 462.7,-191.98"/></g><!-- h2 --><g id="node6" class="node"><title>h2</title><ellipse fill="#fff4ce" stroke="#789abc" stroke-width="2" cx="776.2" cy="-158.4" rx="21.6" ry="21.6"/><text xml:space="preserve" text-anchor="middle" x="776.2" y="-160.55" font-family="Times,serif" font-size="8.00" fill="#789abc">H2</text><text xml:space="preserve" text-anchor="middle" x="776.2" y="-150.8" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 2)</text></g><!-- d1R&#45;&gt;h2 --><g id="edge5" class="edge"><title>d1R&#45;&gt;h2</title><path fill="none" stroke="#789abc" d="M776.2,-215.5C776.2,-208.19 776.2,-199.8 776.2,-191.79"/><polygon fill="#789abc" stroke="#789abc" points="779.7,-191.98 776.2,-181.98 772.7,-191.98 779.7,-191.98"/></g><!-- h3 --><g id="node7" class="node"><title>h3</title><ellipse fill="#fff4ce" stroke="#789abc" stroke-width="2" cx="1012.2" cy="-158.4" rx="21.6" ry="21.6"/><text xml:space="preserve" text-anchor="middle" x="1012.2" y="-160.55" font-family="Times,serif" font-size="8.00" fill="#789abc">H3</text><text xml:space="preserve" text-anchor="middle" x="1012.2" y="-150.8" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 2)</text></g><!-- d1R&#45;&gt;h3 --><g id="edge6" class="edge"><title>d1R&#45;&gt;h3</title><path fill="none" stroke="#789abc" d="M796.73,-229.88C838.05,-216.37 931.49,-185.8 980.63,-169.73"/><polygon fill="#789abc" stroke="#789abc" points="981.69,-173.06 990.11,-166.63 979.52,-166.41 981.69,-173.06"/></g><!-- e0 --><g id="node24" class="node"><title>e0</title><text xml:space="preserve" text-anchor="middle" x="104.2" y="-87.3" font-family="Times,serif" font-size="9.00" fill="#789abc">…</text><text xml:space="preserve" text-anchor="middle" x="104.2" y="-76.05" font-family="Times,serif" font-size="9.00" fill="#789abc">(depth 3..255)</text></g><!-- h0&#45;&gt;e0 --><g id="edge7" class="edge"><title>h0&#45;&gt;e0</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M204.87,-146.34C187.31,-135.74 160.36,-119.49 138.77,-106.46"/><polygon fill="#9ca3af" stroke="#9ca3af" points="140.64,-103.5 130.27,-101.33 137.02,-109.49 140.64,-103.5"/></g><!-- e0r --><g id="node28" class="node"><title>e0r</title><text xml:space="preserve" text-anchor="middle" x="223.2" y="-87.3" font-family="Times,serif" font-size="9.00" fill="#789abc">…</text><text xml:space="preserve" text-anchor="middle" x="223.2" y="-76.05" font-family="Times,serif" font-size="9.00" fill="#789abc">(depth 3..255)</text></g><!-- h0&#45;&gt;e0r --><g id="edge8" class="edge"><title>h0&#45;&gt;e0r</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M223.2,-136.63C223.2,-128.84 223.2,-119.89 223.2,-111.67"/><polygon fill="#9ca3af" stroke="#9ca3af" points="226.7,-111.91 223.2,-101.91 219.7,-111.91 226.7,-111.91"/></g><!-- e1 --><g id="node25" class="node"><title>e1</title><text xml:space="preserve" text-anchor="middle" x="420.2" y="-87.3" font-family="Times,serif" font-size="9.00" fill="#789abc">…</text><text xml:space="preserve" text-anchor="middle" x="420.2" y="-76.05" font-family="Times,serif" font-size="9.00" fill="#789abc">(depth 3..255)</text></g><!-- h1&#45;&gt;e1 --><g id="edge9" class="edge"><title>h1&#45;&gt;e1</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M449.16,-138.91C444.43,-130.22 438.73,-119.72 433.65,-110.36"/><polygon fill="#9ca3af" stroke="#9ca3af" points="436.82,-108.86 428.97,-101.74 430.67,-112.2 436.82,-108.86"/></g><!-- e1r --><g id="node29" class="node"><title>e1r</title><text xml:space="preserve" text-anchor="middle" x="499.2" y="-87.3" font-family="Times,serif" font-size="9.00" fill="#789abc">…</text><text xml:space="preserve" text-anchor="middle" x="499.2" y="-76.05" font-family="Times,serif" font-size="9.00" fill="#789abc">(depth 3..255)</text></g><!-- h1&#45;&gt;e1r --><g id="edge10" class="edge"><title>h1&#45;&gt;e1r</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M469.5,-138.91C474.34,-130.22 480.19,-119.72 485.41,-110.36"/><polygon fill="#9ca3af" stroke="#9ca3af" points="488.4,-112.17 490.21,-101.73 482.29,-108.77 488.4,-112.17"/></g><!-- e2 --><g id="node26" class="node"><title>e2</title><text xml:space="preserve" text-anchor="middle" x="736.2" y="-87.3" font-family="Times,serif" font-size="9.00" fill="#789abc">…</text><text xml:space="preserve" text-anchor="middle" x="736.2" y="-76.05" font-family="Times,serif" font-size="9.00" fill="#789abc">(depth 3..255)</text></g><!-- h2&#45;&gt;e2 --><g id="edge11" class="edge"><title>h2&#45;&gt;e2</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M765.9,-138.91C761.06,-130.22 755.21,-119.72 749.99,-110.36"/><polygon fill="#9ca3af" stroke="#9ca3af" points="753.11,-108.77 745.19,-101.73 747,-112.17 753.11,-108.77"/></g><!-- e2r --><g id="node30" class="node"><title>e2r</title><text xml:space="preserve" text-anchor="middle" x="815.2" y="-87.3" font-family="Times,serif" font-size="9.00" fill="#789abc">…</text><text xml:space="preserve" text-anchor="middle" x="815.2" y="-76.05" font-family="Times,serif" font-size="9.00" fill="#789abc">(depth 3..255)</text></g><!-- h2&#45;&gt;e2r --><g id="edge12" class="edge"><title>h2&#45;&gt;e2r</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M786.24,-138.91C790.97,-130.22 796.67,-119.72 801.75,-110.36"/><polygon fill="#9ca3af" stroke="#9ca3af" points="804.73,-112.2 806.43,-101.74 798.58,-108.86 804.73,-112.2"/></g><!-- e3 --><g id="node27" class="node"><title>e3</title><text xml:space="preserve" text-anchor="middle" x="1012.2" y="-87.3" font-family="Times,serif" font-size="9.00" fill="#789abc">…</text><text xml:space="preserve" text-anchor="middle" x="1012.2" y="-76.05" font-family="Times,serif" font-size="9.00" fill="#789abc">(depth 3..255)</text></g><!-- h3&#45;&gt;e3 --><g id="edge13" class="edge"><title>h3&#45;&gt;e3</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M1012.2,-136.63C1012.2,-128.84 1012.2,-119.89 1012.2,-111.67"/><polygon fill="#9ca3af" stroke="#9ca3af" points="1015.7,-111.91 1012.2,-101.91 1008.7,-111.91 1015.7,-111.91"/></g><!-- e3r --><g id="node31" class="node"><title>e3r</title><text xml:space="preserve" text-anchor="middle" x="1131.2" y="-87.3" font-family="Times,serif" font-size="9.00" fill="#789abc">…</text><text xml:space="preserve" text-anchor="middle" x="1131.2" y="-76.05" font-family="Times,serif" font-size="9.00" fill="#789abc">(depth 3..255)</text></g><!-- h3&#45;&gt;e3r --><g id="edge14" class="edge"><title>h3&#45;&gt;e3r</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M1030.53,-146.34C1048.09,-135.74 1075.04,-119.49 1096.63,-106.46"/><polygon fill="#9ca3af" stroke="#9ca3af" points="1098.38,-109.49 1105.13,-101.33 1094.76,-103.5 1098.38,-109.49"/></g><!-- l0 --><g id="node8" class="node"><title>l0</title><ellipse fill="none" stroke="#789abc" cx="25.2" cy="-16.2" rx="25.2" ry="16.2"/><text xml:space="preserve" text-anchor="middle" x="25.2" y="-18.35" font-family="Times,serif" font-size="8.00" fill="#789abc">doc A</text><text xml:space="preserve" text-anchor="middle" x="25.2" y="-8.6" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 256)</text></g><!-- l0r --><g id="node9" class="node"><title>l0r</title><ellipse fill="none" stroke="#789abc" stroke-dasharray="5,2" cx="104.2" cy="-16.2" rx="25.2" ry="16.2"/><text xml:space="preserve" text-anchor="middle" x="104.2" y="-18.35" font-family="Times,serif" font-size="8.00" fill="#789abc">(empty)</text><text xml:space="preserve" text-anchor="middle" x="104.2" y="-8.6" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 256)</text></g><!-- l1l --><g id="node10" class="node"><title>l1l</title><ellipse fill="none" stroke="#789abc" stroke-dasharray="5,2" cx="183.2" cy="-16.2" rx="25.2" ry="16.2"/><text xml:space="preserve" text-anchor="middle" x="183.2" y="-18.35" font-family="Times,serif" font-size="8.00" fill="#789abc">(empty)</text><text xml:space="preserve" text-anchor="middle" x="183.2" y="-8.6" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 256)</text></g><!-- l1 --><g id="node11" class="node"><title>l1</title><ellipse fill="none" stroke="#789abc" cx="262.2" cy="-16.2" rx="25.2" ry="16.2"/><text xml:space="preserve" text-anchor="middle" x="262.2" y="-18.35" font-family="Times,serif" font-size="8.00" fill="#789abc">doc B</text><text xml:space="preserve" text-anchor="middle" x="262.2" y="-8.6" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 256)</text></g><!-- l2 --><g id="node12" class="node"><title>l2</title><ellipse fill="none" stroke="#789abc" cx="341.2" cy="-16.2" rx="25.2" ry="16.2"/><text xml:space="preserve" text-anchor="middle" x="341.2" y="-18.35" font-family="Times,serif" font-size="8.00" fill="#789abc">doc C</text><text xml:space="preserve" text-anchor="middle" x="341.2" y="-8.6" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 256)</text></g><!-- l2r --><g id="node13" class="node"><title>l2r</title><ellipse fill="none" stroke="#789abc" stroke-dasharray="5,2" cx="420.2" cy="-16.2" rx="25.2" ry="16.2"/><text xml:space="preserve" text-anchor="middle" x="420.2" y="-18.35" font-family="Times,serif" font-size="8.00" fill="#789abc">(empty)</text><text xml:space="preserve" text-anchor="middle" x="420.2" y="-8.6" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 256)</text></g><!-- l3 --><g id="node14" class="node"><title>l3</title><ellipse fill="none" stroke="#789abc" stroke-dasharray="5,2" cx="499.2" cy="-16.2" rx="25.2" ry="16.2"/><text xml:space="preserve" text-anchor="middle" x="499.2" y="-18.35" font-family="Times,serif" font-size="8.00" fill="#789abc">(empty)</text><text xml:space="preserve" text-anchor="middle" x="499.2" y="-8.6" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 256)</text></g><!-- l3r --><g id="node15" class="node"><title>l3r</title><ellipse fill="none" stroke="#789abc" stroke-dasharray="5,2" cx="578.2" cy="-16.2" rx="25.2" ry="16.2"/><text xml:space="preserve" text-anchor="middle" x="578.2" y="-18.35" font-family="Times,serif" font-size="8.00" fill="#789abc">(empty)</text><text xml:space="preserve" text-anchor="middle" x="578.2" y="-8.6" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 256)</text></g><!-- l4 --><g id="node16" class="node"><title>l4</title><ellipse fill="none" stroke="#789abc" cx="657.2" cy="-16.2" rx="25.2" ry="16.2"/><text xml:space="preserve" text-anchor="middle" x="657.2" y="-18.35" font-family="Times,serif" font-size="8.00" fill="#789abc">doc D</text><text xml:space="preserve" text-anchor="middle" x="657.2" y="-8.6" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 256)</text></g><!-- l4r --><g id="node17" class="node"><title>l4r</title><ellipse fill="none" stroke="#789abc" cx="736.2" cy="-16.2" rx="25.2" ry="16.2"/><text xml:space="preserve" text-anchor="middle" x="736.2" y="-18.35" font-family="Times,serif" font-size="8.00" fill="#789abc">doc E</text><text xml:space="preserve" text-anchor="middle" x="736.2" y="-8.6" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 256)</text></g><!-- l5 --><g id="node18" class="node"><title>l5</title><ellipse fill="none" stroke="#789abc" stroke-dasharray="5,2" cx="815.2" cy="-16.2" rx="25.2" ry="16.2"/><text xml:space="preserve" text-anchor="middle" x="815.2" y="-18.35" font-family="Times,serif" font-size="8.00" fill="#789abc">(empty)</text><text xml:space="preserve" text-anchor="middle" x="815.2" y="-8.6" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 256)</text></g><!-- l5r --><g id="node19" class="node"><title>l5r</title><ellipse fill="none" stroke="#789abc" stroke-dasharray="5,2" cx="894.2" cy="-16.2" rx="25.2" ry="16.2"/><text xml:space="preserve" text-anchor="middle" x="894.2" y="-18.35" font-family="Times,serif" font-size="8.00" fill="#789abc">(empty)</text><text xml:space="preserve" text-anchor="middle" x="894.2" y="-8.6" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 256)</text></g><!-- l6r --><g id="node20" class="node"><title>l6r</title><ellipse fill="none" stroke="#789abc" cx="973.2" cy="-16.2" rx="25.2" ry="16.2"/><text xml:space="preserve" text-anchor="middle" x="973.2" y="-18.35" font-family="Times,serif" font-size="8.00" fill="#789abc">doc E</text><text xml:space="preserve" text-anchor="middle" x="973.2" y="-8.6" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 256)</text></g><!-- l6 --><g id="node21" class="node"><title>l6</title><ellipse fill="none" stroke="#789abc" cx="1052.2" cy="-16.2" rx="25.2" ry="16.2"/><text xml:space="preserve" text-anchor="middle" x="1052.2" y="-18.35" font-family="Times,serif" font-size="8.00" fill="#789abc">doc F</text><text xml:space="preserve" text-anchor="middle" x="1052.2" y="-8.6" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 256)</text></g><!-- l7 --><g id="node22" class="node"><title>l7</title><ellipse fill="none" stroke="#789abc" cx="1131.2" cy="-16.2" rx="25.2" ry="16.2"/><text xml:space="preserve" text-anchor="middle" x="1131.2" y="-18.35" font-family="Times,serif" font-size="8.00" fill="#789abc">doc G</text><text xml:space="preserve" text-anchor="middle" x="1131.2" y="-8.6" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 256)</text></g><!-- l7r --><g id="node23" class="node"><title>l7r</title><ellipse fill="none" stroke="#789abc" cx="1210.2" cy="-16.2" rx="25.2" ry="16.2"/><text xml:space="preserve" text-anchor="middle" x="1210.2" y="-18.35" font-family="Times,serif" font-size="8.00" fill="#789abc">doc H</text><text xml:space="preserve" text-anchor="middle" x="1210.2" y="-8.6" font-family="Times,serif" font-size="8.00" fill="#789abc">(depth 256)</text></g><!-- e0&#45;&gt;l0 --><g id="edge15" class="edge"><title>e0&#45;&gt;l0</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M86.27,-68.53C75.17,-59.2 60.79,-47.12 48.78,-37.02"/><polygon fill="#9ca3af" stroke="#9ca3af" points="51.2,-34.49 41.3,-30.73 46.7,-39.84 51.2,-34.49"/></g><!-- e0&#45;&gt;l0r --><g id="edge16" class="edge"><title>e0&#45;&gt;l0r</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M104.2,-68.53C104.2,-61.25 104.2,-52.29 104.2,-43.9"/><polygon fill="#9ca3af" stroke="#9ca3af" points="107.7,-44.18 104.2,-34.18 100.7,-44.18 107.7,-44.18"/></g><!-- e1&#45;&gt;l2 --><g id="edge19" class="edge"><title>e1&#45;&gt;l2</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M402.27,-68.53C391.17,-59.2 376.79,-47.12 364.78,-37.02"/><polygon fill="#9ca3af" stroke="#9ca3af" points="367.2,-34.49 357.3,-30.73 362.7,-39.84 367.2,-34.49"/></g><!-- e1&#45;&gt;l2r --><g id="edge20" class="edge"><title>e1&#45;&gt;l2r</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M420.2,-68.53C420.2,-61.25 420.2,-52.29 420.2,-43.9"/><polygon fill="#9ca3af" stroke="#9ca3af" points="423.7,-44.18 420.2,-34.18 416.7,-44.18 423.7,-44.18"/></g><!-- e2&#45;&gt;l4 --><g id="edge23" class="edge"><title>e2&#45;&gt;l4</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M718.27,-68.53C707.17,-59.2 692.79,-47.12 680.78,-37.02"/><polygon fill="#9ca3af" stroke="#9ca3af" points="683.2,-34.49 673.3,-30.73 678.7,-39.84 683.2,-34.49"/></g><!-- e2&#45;&gt;l4r --><g id="edge24" class="edge"><title>e2&#45;&gt;l4r</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M736.2,-68.53C736.2,-61.25 736.2,-52.29 736.2,-43.9"/><polygon fill="#9ca3af" stroke="#9ca3af" points="739.7,-44.18 736.2,-34.18 732.7,-44.18 739.7,-44.18"/></g><!-- e3&#45;&gt;l6r --><g id="edge27" class="edge"><title>e3&#45;&gt;l6r</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M1003.35,-68.53C998.65,-60.53 992.75,-50.49 987.43,-41.42"/><polygon fill="#9ca3af" stroke="#9ca3af" points="990.6,-39.91 982.51,-33.06 984.56,-43.45 990.6,-39.91"/></g><!-- e3&#45;&gt;l6 --><g id="edge28" class="edge"><title>e3&#45;&gt;l6</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M1021.28,-68.53C1026.1,-60.53 1032.15,-50.49 1037.61,-41.42"/><polygon fill="#9ca3af" stroke="#9ca3af" points="1040.49,-43.42 1042.65,-33.05 1034.49,-39.81 1040.49,-43.42"/></g><!-- e0r&#45;&gt;l1l --><g id="edge17" class="edge"><title>e0r&#45;&gt;l1l</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M214.12,-68.53C209.3,-60.53 203.25,-50.49 197.79,-41.42"/><polygon fill="#9ca3af" stroke="#9ca3af" points="200.91,-39.81 192.75,-33.05 194.91,-43.42 200.91,-39.81"/></g><!-- e0r&#45;&gt;l1 --><g id="edge18" class="edge"><title>e0r&#45;&gt;l1</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M232.05,-68.53C236.75,-60.53 242.65,-50.49 247.97,-41.42"/><polygon fill="#9ca3af" stroke="#9ca3af" points="250.84,-43.45 252.89,-33.06 244.8,-39.91 250.84,-43.45"/></g><!-- e1r&#45;&gt;l3 --><g id="edge21" class="edge"><title>e1r&#45;&gt;l3</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M499.2,-68.53C499.2,-61.25 499.2,-52.29 499.2,-43.9"/><polygon fill="#9ca3af" stroke="#9ca3af" points="502.7,-44.18 499.2,-34.18 495.7,-44.18 502.7,-44.18"/></g><!-- e1r&#45;&gt;l3r --><g id="edge22" class="edge"><title>e1r&#45;&gt;l3r</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M517.13,-68.53C528.23,-59.2 542.61,-47.12 554.62,-37.02"/><polygon fill="#9ca3af" stroke="#9ca3af" points="556.7,-39.84 562.1,-30.73 552.2,-34.49 556.7,-39.84"/></g><!-- e2r&#45;&gt;l5 --><g id="edge25" class="edge"><title>e2r&#45;&gt;l5</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M815.2,-68.53C815.2,-61.25 815.2,-52.29 815.2,-43.9"/><polygon fill="#9ca3af" stroke="#9ca3af" points="818.7,-44.18 815.2,-34.18 811.7,-44.18 818.7,-44.18"/></g><!-- e2r&#45;&gt;l5r --><g id="edge26" class="edge"><title>e2r&#45;&gt;l5r</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M833.13,-68.53C844.23,-59.2 858.61,-47.12 870.62,-37.02"/><polygon fill="#9ca3af" stroke="#9ca3af" points="872.7,-39.84 878.1,-30.73 868.2,-34.49 872.7,-39.84"/></g><!-- e3r&#45;&gt;l7 --><g id="edge29" class="edge"><title>e3r&#45;&gt;l7</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M1131.2,-68.53C1131.2,-61.25 1131.2,-52.29 1131.2,-43.9"/><polygon fill="#9ca3af" stroke="#9ca3af" points="1134.7,-44.18 1131.2,-34.18 1127.7,-44.18 1134.7,-44.18"/></g><!-- e3r&#45;&gt;l7r --><g id="edge30" class="edge"><title>e3r&#45;&gt;l7r</title><path fill="none" stroke="#9ca3af" stroke-dasharray="1,5" d="M1149.13,-68.53C1160.23,-59.2 1174.61,-47.12 1186.62,-37.02"/><polygon fill="#9ca3af" stroke="#9ca3af" points="1188.7,-39.84 1194.1,-30.73 1184.2,-34.49 1188.7,-39.84"/></g></g></svg></p>
<h4 id="cddl-syn-payload-body">CDDL — <code>.syn</code> payload-body<a class="headerlink" href="#cddl-syn-payload-body" title="Permanent link">&para;</a></h4>
<div class="language-cddl highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1">; Payload body fits within the Common Message Envelope</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nc">payload-body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">msg-syn</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="c1">; numeric keys</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="nc">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="nc">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="nc">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="nc">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="nc">peer_root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="nc">peer_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="nc">msg-syn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">  </span><span class="nc">root</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">root-hash</span><span class="p">,</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">  </span><span class="nc">count</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">uint</span><span class="p">,</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">  </span><span class="nc">to</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">peer-pubkey</span><span class="p">,</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">  </span><span class="o">?</span><span class="w"> </span><span class="nc">prefix</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">prefix-array</span><span class="p">,</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">  </span><span class="nc">peer_root</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">root-hash</span><span class="p">,</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">  </span><span class="nc">peer_count</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">uint</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="p">}</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="nc">prefix-array</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">    </span><span class="p">[</span><span class="w"> </span><span class="m">2</span><span class="o">*</span><span class="m">2</span><span class="w"> </span><span class="nc">prefix-hash</span><span class="w"> </span><span class="p">]</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">  </span><span class="o">/</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="m">4</span><span class="o">*</span><span class="m">4</span><span class="w"> </span><span class="nc">prefix-hash</span><span class="w"> </span><span class="p">]</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="w">  </span><span class="o">/</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="m">8</span><span class="o">*</span><span class="m">8</span><span class="w"> </span><span class="nc">prefix-hash</span><span class="w"> </span><span class="p">]</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="w">  </span><span class="o">/</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="m">16</span><span class="o">*</span><span class="m">16</span><span class="w"> </span><span class="nc">prefix-hash</span><span class="w"> </span><span class="p">]</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="w">  </span><span class="o">/</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="m">32</span><span class="o">*</span><span class="m">32</span><span class="w"> </span><span class="nc">prefix-hash</span><span class="w"> </span><span class="p">]</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="w">  </span><span class="o">/</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="m">64</span><span class="o">*</span><span class="m">64</span><span class="w"> </span><span class="nc">prefix-hash</span><span class="w"> </span><span class="p">]</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="w">  </span><span class="o">/</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="m">128</span><span class="o">*</span><span class="m">128</span><span class="w"> </span><span class="nc">prefix-hash</span><span class="w"> </span><span class="p">]</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="w">  </span><span class="o">/</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="m">256</span><span class="o">*</span><span class="m">256</span><span class="w"> </span><span class="nc">prefix-hash</span><span class="w"> </span><span class="p">]</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="w">  </span><span class="o">/</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="m">512</span><span class="o">*</span><span class="m">512</span><span class="w"> </span><span class="nc">prefix-hash</span><span class="w"> </span><span class="p">]</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="w">  </span><span class="o">/</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="m">1024</span><span class="o">*</span><span class="m">1024</span><span class="w"> </span><span class="nc">prefix-hash</span><span class="w"> </span><span class="p">]</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="w">  </span><span class="o">/</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="m">2048</span><span class="o">*</span><span class="m">2048</span><span class="w"> </span><span class="nc">prefix-hash</span><span class="w"> </span><span class="p">]</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="w">  </span><span class="o">/</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="m">4096</span><span class="o">*</span><span class="m">4096</span><span class="w"> </span><span class="nc">prefix-hash</span><span class="w"> </span><span class="p">]</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="w">  </span><span class="o">/</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="m">8192</span><span class="o">*</span><span class="m">8192</span><span class="w"> </span><span class="nc">prefix-hash</span><span class="w"> </span><span class="p">]</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="w">  </span><span class="o">/</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="m">16384</span><span class="o">*</span><span class="m">16384</span><span class="w"> </span><span class="nc">prefix-hash</span><span class="w"> </span><span class="p">]</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="c1">; self-contained types</span>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a><span class="nc">blake3-256</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">bytes</span><span class="w"> </span><span class="ow">.size</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="c1">; BLAKE3-256 output</span>
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="nc">root-hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">blake3-256</span><span class="w">      </span><span class="c1">; Root hash of the Sparse Merkle Tree</span>
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="nc">prefix-hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">blake3-256</span><span class="w">    </span><span class="c1">; Node hash at depth D (prefix bucket) of the SMT</span>
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a><span class="nc">ed25519-pubkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">bytes</span><span class="w"> </span><span class="ow">.size</span><span class="w"> </span><span class="mi">32</span>
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a><span class="nc">peer-pubkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ed25519-pubkey</span>
</span></code></pre></div>
<p>Diagnostic example (payload-body decoded):</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>{ 
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>  1: h&#39;aaaa...aaaa&#39;, 
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>  2: 100, 
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>  3: h&#39;cafebabe&#39; 
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>}
</span></code></pre></div>
<p>Diagram — Sync Handshake</p>
<pre class="mermaid"><code>sequenceDiagram
  autonumber
  participant R as Requester
  participant D as DHT
  participant S as Responder(s)
  participant PS as PubSub
  R-&gt;&gt;PS: .syn [to, root_R, count_R, peer_root, peer_count, prefix?]
  PS--&gt;&gt;S: .syn
  rect rgb(245,245,245)
    Note over S: Pre-publish check for .dif
    S-&gt;&gt;D: Provide(docs/manifest CIDs)
    S-&gt;&gt;D: FindProviders(CID)
    D--&gt;&gt;S: provider ≠ S (OK)
  end
  S-&gt;&gt;PS: .dif [in_reply_to, (docs | manifest), root_S, count_S, (+ ttl when manifest)]
  PS--&gt;&gt;R: .dif
  R-&gt;&gt;R: fetch+pin, update SMT → parity</code></pre>
<h3 id="dif-topic-basedif">.dif (topic <code>&lt;base&gt;.dif</code>)<a class="headerlink" href="#dif-topic-basedif" title="Permanent link">&para;</a></h3>
<p><strong>Semantics:</strong></p>
<p>The Reconciliation reply.
Carries the same Document Dissemination payload as <code>.new</code>, but is sent specifically in response to a <code>.syn</code>.</p>
<p><strong>Payload-body:</strong></p>
<p>Uses the shared Document Dissemination payload (see “Document Dissemination”).</p>
<p><strong>Topic rules:</strong></p>
<ul>
<li><strong>in_reply_to</strong> MUST be present and MUST reference the <code>.syn</code> being answered (its envelope seq).</li>
<li><strong>docs</strong> or <strong>manifest</strong> MUST be present (exactly one of them).</li>
<li><strong>ttl</strong> MUST be present when <strong>manifest</strong> is used; responders MUST keep manifest blocks available for at least ttl seconds.</li>
</ul>
<p>Responders infer the requested depth <span class="arithmatex">\(d\)</span> from the length of the <code>.syn</code> prefix array
(<span class="arithmatex">\(2^d\)</span>) and reply with ALL documents that mismatch under that partitioning.
On reception, the requesting peer will ignore any documents it already has and only apply missing documents.
Sending all documents in a bucket ensures rapid convergence for all peers in the network.</p>
<p><strong>Processing:</strong></p>
<p>Prior to publishing a <code>.dif</code> with any <code>cidv1</code> (inline or via manifest),
the responder MUST ensure each CID is discoverable via the DHT by calling Provide(CID) and then
FindProviders(CID) and receiving at least one provider peer ID that is not the responder’s own.</p>
<p>If not satisfied, retry with backoff before publishing.
When a manifest is used, this applies to the manifest CID itself and to every CID listed within the manifest.</p>
<ul>
<li>Requesters fetch+pin any CIDs listed inline or in the diff manifest, update SMT, and check parity.</li>
<li>Observers MAY also use <code>.dif</code> to converge faster.</li>
</ul>
<h3 id="prv-topic-baseprv-optional">.prv (topic <code>&lt;base&gt;.prv</code>, OPTIONAL)<a class="headerlink" href="#prv-topic-baseprv-optional" title="Permanent link">&para;</a></h3>
<p><strong>Semantics:</strong></p>
<p>Request SMT inclusion proof(s) for a specific CID from one or more peers.</p>
<p><strong>Payload-body Keys:</strong></p>
<table>
<thead>
<tr>
<th>Index</th>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><strong>cid</strong></td>
<td>cidv1</td>
<td>the document CID requested</td>
</tr>
<tr>
<td>2</td>
<td><strong>hpke_pkR</strong></td>
<td>bytes .size 32</td>
<td>requester’s ephemeral X25519 public key (REQUIRED)</td>
</tr>
<tr>
<td>3</td>
<td><strong>provers</strong></td>
<td>array of peer-pubkey</td>
<td>OPTIONAL — explicit peers asked to respond</td>
</tr>
</tbody>
</table>
<p>Precondition (MUST): Before publishing <code>.prv</code> that references <code>cid</code>, the requester MUST ensure
FindProviders(cid) returns at least one provider peer ID that is not the requester’s own; otherwise retry with backoff.
This avoids soliciting proofs for undiscoverable content.</p>
<h4 id="prv-processing">.prv Processing<a class="headerlink" href="#prv-processing" title="Permanent link">&para;</a></h4>
<ul>
<li>If <code>provers</code> is present, only listed peers SHOULD answer; others SHOULD ignore.</li>
<li>If <code>provers</code> is absent, ALL enrolled provers that are subscribed to <code>&lt;base&gt;.prv</code> SHOULD reply (after normal jitter).
  Peers that are not provers (e.g., nodes that temporarily subscribe only to issue a request) MUST NOT reply.</li>
<li>Responders DO NOT suppress based on other <code>.prf</code> replies (multiple independent proofs are acceptable).</li>
<li><code>.prv</code> carries no updates by itself.</li>
</ul>
<h4 id="cddl-prv-payload-body">CDDL — <code>.prv</code> payload-body<a class="headerlink" href="#cddl-prv-payload-body" title="Permanent link">&para;</a></h4>
<div class="language-cddl highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1">; Payload body fits within the Common Message Envelope</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nc">payload-body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">msg-prv</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="c1">; numeric keys</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="nc">cid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="nc">hpke_pkR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="nc">provers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="nc">msg-prv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">  </span><span class="nc">cid</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">cidv1</span><span class="p">,</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">  </span><span class="nc">hpke_pkR</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">x25519-pubkey</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">  </span><span class="o">?</span><span class="w"> </span><span class="nc">provers</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="o">*</span><span class="w"> </span><span class="nc">peer-pubkey</span><span class="p">],</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="p">}</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="c1">; self-contained types</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="nc">x25519-pubkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">bytes</span><span class="w"> </span><span class="ow">.size</span><span class="w"> </span><span class="mi">32</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="nc">ed25519-pubkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">bytes</span><span class="w"> </span><span class="ow">.size</span><span class="w"> </span><span class="mi">32</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="nc">peer-pubkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ed25519-pubkey</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="nc">cidv1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">bytes</span><span class="w"> </span><span class="ow">.size</span><span class="w"> </span><span class="p">(</span><span class="mi">36</span><span class="o">..</span><span class="mi">40</span><span class="p">)</span><span class="w">  </span><span class="c1">; CIDv1 (binary); multihash MUST be sha2-256 (32-byte digest)</span>
</span></code></pre></div>
<h4 id="diagnostic-example-payload-body-decoded_1">Diagnostic example (payload-body decoded)<a class="headerlink" href="#diagnostic-example-payload-body-decoded_1" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>{ 
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>  1: h&#39;05e8...cidv1&#39;, 
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>  2: h&#39;5566...&#39;,
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>  3: [ h&#39;aa11bb22&#39;, h&#39;cc33dd44&#39; ]
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>}
</span></code></pre></div>
<h3 id="prf-topic-baseprf-optional">.prf (topic <code>&lt;base&gt;.prf</code>, OPTIONAL)<a class="headerlink" href="#prf-topic-baseprf-optional" title="Permanent link">&para;</a></h3>
<p><strong>Semantics:</strong> Reply to a <code>.prv</code> with an SMT inclusion proof for the requested <code>cid</code>.</p>
<p><strong>Payload-body Keys (outer, unencrypted):</strong></p>
<table>
<thead>
<tr>
<th>Index</th>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><strong>in_reply_to</strong></td>
<td>uuid</td>
<td>UUIDv7 of the <code>.prv</code> being answered</td>
</tr>
<tr>
<td>2</td>
<td><strong>hpke_enc</strong></td>
<td>bytes .size 32</td>
<td>responder’s HPKE encapsulated ephemeral public key (REQUIRED)</td>
</tr>
<tr>
<td>3</td>
<td><strong>ct</strong></td>
<td>bytes</td>
<td>HPKE ciphertext of the proof payload (REQUIRED)</td>
</tr>
</tbody>
</table>
<p><strong>Encrypted plaintext fields (see <code>prf-plaintext</code> CDDL):</strong></p>
<table>
<thead>
<tr>
<th>Index</th>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><strong>kt-responder</strong></td>
<td>peer-pubkey</td>
<td>MUST equal the envelope peer-pubkey</td>
</tr>
<tr>
<td>2</td>
<td><strong>kt-in_reply_to</strong></td>
<td>uuid</td>
<td>MUST equal the outer in_reply_to and match the referenced <code>.prv</code> seq</td>
</tr>
<tr>
<td>3</td>
<td><strong>kt-cid</strong></td>
<td>cidv1</td>
<td>MUST equal the requested <code>cid</code> from the <code>.prv</code></td>
</tr>
<tr>
<td>4</td>
<td><strong>kt-root</strong></td>
<td>root-hash</td>
<td>SMT root the proof is about</td>
</tr>
<tr>
<td>5</td>
<td><strong>kt-count</strong></td>
<td>uint</td>
<td>Document count at that root</td>
</tr>
<tr>
<td>6</td>
<td><strong>kt-present</strong></td>
<td>bool</td>
<td>Whether the CID is included</td>
</tr>
<tr>
<td>7</td>
<td><strong>kt-proof</strong></td>
<td>smt-proof</td>
<td>Inclusion/non-inclusion proof</td>
</tr>
</tbody>
</table>
<p><strong>Processing:</strong></p>
<ul>
<li>Only the requester possessing the matching X25519 private key can decrypt <code>ct</code>.</li>
<li>After decryption, verify bindings and the SMT proof; see Encrypted Proofs.</li>
<li>Non-requesters cannot decrypt and SHOULD ignore the ciphertext.</li>
</ul>
<h4 id="cddl-prf-payload-body-and-encrypted-plaintext">CDDL — <code>.prf</code> payload-body and encrypted plaintext<a class="headerlink" href="#cddl-prf-payload-body-and-encrypted-plaintext" title="Permanent link">&para;</a></h4>
<div class="language-cddl highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nc">payload-body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">msg-prf</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="c1">; numeric keys (1-based)</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="nc">in_reply_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="nc">hpke_enc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="nc">ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="nc">msg-prf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">  </span><span class="nc">in_reply_to</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">uuid</span><span class="p">,</span><span class="w">         </span><span class="c1">; .prv being replied to</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">  </span><span class="nc">hpke_enc</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">x25519-pubkey</span><span class="p">,</span><span class="w">   </span><span class="c1">; public X25519 key required for requester to read `ct`</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">  </span><span class="nc">ct</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">bytes</span><span class="w">                  </span><span class="c1">; HPKE ciphertext of prf-plaintext</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="p">}</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="c1">; self-contained types</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="nc">blake3-256</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">bytes</span><span class="w"> </span><span class="ow">.size</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="c1">; BLAKE3-256 output</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="nc">root-hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">blake3-256</span><span class="w">      </span><span class="c1">; Root hash of the Sparse Merkle Tree</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="nc">prefix-hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">blake3-256</span><span class="w">    </span><span class="c1">; Node hash at depth D (prefix bucket) of the SMT</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="nc">ed25519-pubkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">bytes</span><span class="w"> </span><span class="ow">.size</span><span class="w"> </span><span class="mi">32</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="nc">peer-pubkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ed25519-pubkey</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="nc">cidv1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">bytes</span><span class="w"> </span><span class="ow">.size</span><span class="w"> </span><span class="p">(</span><span class="mi">36</span><span class="o">..</span><span class="mi">40</span><span class="p">)</span><span class="w">  </span><span class="c1">; CIDv1 (binary); multihash MUST be sha2-256 (32-byte digest)</span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="nc">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">#6.37</span><span class="p">(</span><span class="nb">bytes</span><span class="w"> </span><span class="ow">.size</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="c1">; UUIDv7</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="nc">x25519-pubkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">bytes</span><span class="w"> </span><span class="ow">.size</span><span class="w"> </span><span class="mi">32</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="c1">; prf-plaintext (encrypted inside ct)</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="c1">; numeric keys for prf-plaintext</span>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="nc">kt-responder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="nc">kt-in_reply_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="nc">kt-cid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="nc">kt-root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="nc">kt-count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="nc">kt-present</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="nc">kt-proof</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="nc">prf-plaintext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="w">  </span><span class="nc">kt-responder</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">peer-pubkey</span><span class="p">,</span><span class="w"> </span><span class="c1">; MUST equal envelope peer</span>
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="w">  </span><span class="nc">kt-in_reply_to</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">uuid</span><span class="p">,</span><span class="w">      </span><span class="c1">; MUST equal outer in_reply_to</span>
</span><span id="__span-8-37"><a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a><span class="w">  </span><span class="nc">kt-cid</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">cidv1</span><span class="p">,</span><span class="w">             </span><span class="c1">; MUST equal requested cid from .prv</span>
</span><span id="__span-8-38"><a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a><span class="w">  </span><span class="nc">kt-root</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">root-hash</span><span class="p">,</span>
</span><span id="__span-8-39"><a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a><span class="w">  </span><span class="nc">kt-count</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">uint</span><span class="p">,</span>
</span><span id="__span-8-40"><a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a><span class="w">  </span><span class="nc">kt-present</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">bool</span><span class="p">,</span>
</span><span id="__span-8-41"><a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a><span class="w">  </span><span class="nc">kt-proof</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">smt-proof</span>
</span><span id="__span-8-42"><a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a><span class="p">}</span>
</span><span id="__span-8-43"><a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a>
</span><span id="__span-8-44"><a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a><span class="c1">; smt-proof key constants (see SMT Proof Encoding)</span>
</span></code></pre></div>
<p>Diagnostic example (payload-body decoded):</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>{ 
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>  1: h&#39;018f0f92c3f8a9b2c7d1112233445570&#39;,  ; in_reply_to (uuidv7)
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>  2: h&#39;1122...33&#39;,                          ; hpke_enc (X25519 encapsulated pubkey)
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>  3: h&#39;99aa...ff&#39;                           ; ct (ciphertext)
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>}
</span></code></pre></div>
<h2 id="proof-topics-usage-model-optional">Proof Topics Usage Model (Optional)<a class="headerlink" href="#proof-topics-usage-model-optional" title="Permanent link">&para;</a></h2>
<p><strong>Roles:</strong></p>
<ul>
<li>Proven storage peers: nodes that commit to answering proof requests.</li>
<li>Non-proven peers: nodes that generally do not generate proofs but may occasionally request them.</li>
</ul>
<p><strong>Recommended subscription pattern:</strong></p>
<ul>
<li>Proven storage peers SHOULD remain subscribed to <code>&lt;base&gt;.prv</code> only.
  Upon receiving a <code>.prv</code> they intend to answer, they SHOULD:<ol>
<li>temporarily subscribe to <code>&lt;base&gt;.prf</code></li>
<li>apply responder jitter</li>
<li>publish their <code>.prf</code>, and</li>
<li>promptly unsubscribe.</li>
<li>They DO NOT suppress due to other <code>.prf</code> replies; proofs are tied to the responder’s storage commitment.</li>
</ol>
</li>
<li>Non-proven peers SHOULD remain unsubscribed from proof topics under normal operation.<br />
  When a proof is needed:<ol>
<li>Subscribe to <code>&lt;base&gt;.prv</code> and <code>&lt;base&gt;.prf</code>.</li>
<li>Publish <code>.prv</code> specifying the <code>cid</code> (and optionally specific <code>provers</code>) and include <code>hpke_pkR</code> (ephemeral X25519 public key).</li>
<li>Wait for <code>.prf</code> replies, decrypt, verify, and cache as needed.</li>
<li>Unsubscribe from <code>&lt;base&gt;.prf</code> (and <code>&lt;base&gt;.prv</code> if no further requests).</li>
</ol>
</li>
</ul>
<p><strong>Rationale:</strong> This pattern effectively narrows <code>.prf</code> delivery to the requester and the responding
  prover(s) currently subscribed, approximating point-to-point behavior over pub/sub and reducing
  background load for nodes that do not need proofs.</p>
<h2 id="state-machines">State Machines<a class="headerlink" href="#state-machines" title="Permanent link">&para;</a></h2>
<p><strong>Local peer maintains per-remote-peer sync state for each <code>&lt;base&gt;</code>:</strong></p>
<ul>
<li>Stable: local root equals last known root for all known peers.</li>
<li>Diverged: a mismatch exists (local root ≠ any seen remote root).
  On entering Diverged, start backoff timer.</li>
<li>Reconciling: after backoff expiry, publish <code>.syn</code>; await suitable <code>.dif</code> and apply.</li>
<li>Parity achieved: upon local root matching the responder’s advertised root; return to Stable.</li>
</ul>
<p><strong>Transitions may be triggered by <code>.new</code> or <code>.dif</code> arriving during backoff; if parity is reached, abort solicitation.</strong></p>
<h3 id="diagram-peer-sync-state-machine-per-base">Diagram — Peer Sync State Machine (per <code>&lt;base&gt;</code>)<a class="headerlink" href="#diagram-peer-sync-state-machine-per-base" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>stateDiagram-v2
  [*] --&gt; Stable
  Stable --&gt; Diverged: root mismatch observed
  Diverged --&gt; Reconciling: backoff timer expires
  Reconciling --&gt; Stable: parity achieved
  Diverged --&gt; Stable: passive convergence via .new/.dif
  Reconciling --&gt; Diverged: new mismatch observed</code></pre>
<h2 id="timers-and-retries">Timers and Retries<a class="headerlink" href="#timers-and-retries" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Backoff/jitter before sending <code>.syn</code>:</strong> uniform random in <code>[Tmin, Tmax]</code>
  (implementation-configurable; PoC suggestion: 200–800 ms).</li>
<li><strong>Responder jitter before publishing <code>.dif</code>:</strong> uniform random in <code>[Rmin, Rmax]</code>
  (PoC suggestion: 50–250 ms).
  Cancel if an adequate <code>.dif</code> appears.</li>
<li><strong>Quiet‑period re‑announce on <code>.new</code>:</strong> per‑channel quiet timer with jitter.
  If no <code>.new</code> is observed on <code>&lt;base&gt;.new</code> within <code>Tquiet</code>, publish a <code>.new</code> keepalive with <code>docs=[]</code>
  (empty) carrying only <code>root</code> and <code>count</code>.<ul>
<li>Suggested PoC values: <code>Tquiet</code> uniformly random in [20 s, 60 s].
  Implementations SHOULD reset the timer upon receiving any <code>.new</code> on the channel and SHOULD rate‑limit
  to avoid sending more than one keepalive per <code>Tquiet</code> interval.</li>
<li>Rationale: enables divergence detection and reconciliation liveness in steady state without new content.</li>
</ul>
</li>
<li><strong>Diff manifest TTL:</strong> responders SHOULD keep diff manifest blocks available for at least the announced <code>ttl</code>.
  The <code>ttl</code> field MUST be included in <code>.dif</code> when a <code>manifest</code> is used.</li>
<li><strong>Pinning retry window:</strong> implementations SHOULD configure a bounded retry window <code>Wpin</code>
  (e.g., tens of seconds) during which failed CID fetches from a single <code>.new</code> announcement are retried;
  if the window elapses without all CIDs pinned, release partial pins and schedule a later retry per node policy.</li>
<li><strong>Proof reply jitter:</strong> responders to <code>.prv</code> SHOULD wait a uniform random delay in <code>[Rmin, Rmax]</code>
  (same range as <code>.dif</code>) while temporarily subscribed to <code>&lt;base&gt;.prf</code>, then publish their <code>.prf</code>.</li>
</ul>
<h2 id="transport-and-size-limits">Transport and Size Limits<a class="headerlink" href="#transport-and-size-limits" title="Permanent link">&para;</a></h2>
<ul>
<li>Pub/sub messages SHOULD be ≤ 1 MiB.
  Inline arrays of CIDs in <code>.new</code>/<code>.dif</code> MUST keep total message size ≤ 1 MiB.</li>
<li>For larger batches or diffs, use manifests referenced by CID.</li>
<li>Proof topics: <code>.prf</code> replies SHOULD respect the same ≤ 1 MiB bound.
  Large proofs (e.g., very deep sibling arrays) are unlikely due to SMT’s fixed size but MAY
  necessitate splitting across multiple <code>.prf</code> messages or providing a manifest CID if ever required.</li>
</ul>
<h2 id="smt-sparse-merkle-tree">SMT (Sparse Merkle Tree)<a class="headerlink" href="#smt-sparse-merkle-tree" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Purpose:</strong> Order-independent, append-only set with inclusion and non-inclusion proofs.</li>
<li><strong>Keying (PoC restriction):</strong> For each document CID, require CIDv1 with multihash function sha2-256 (32-byte digest).<ul>
<li>Extract the multihash digest and use it directly as the SMT key <code>k</code> (no re-hashing).</li>
<li>Non-conforming CIDs MUST be rejected.</li>
</ul>
</li>
<li><strong>Depth:</strong> 256 levels (one per bit of <code>k</code>).</li>
<li><strong>Hash function:</strong> BLAKE3-256 (fixed 32-byte output).</li>
<li><strong>Domain separation:</strong><ul>
<li><code>LeafHash = BLAKE3-256(0x00 || k || 0x01)</code> (presence-only set; constant value 0x01).</li>
<li><code>NodeHash = BLAKE3-256(0x01 || left || right)</code>.</li>
<li><code>Empty[d]</code> precomputed per depth: <code>Empty[256] = BLAKE3-256(0x02)</code>, <code>Empty[d] = NodeHash(Empty[d+1], Empty[d+1])</code>.</li>
</ul>
</li>
<li><strong>Root:</strong> 32-byte <code>NodeHash</code> at depth 0 (BLAKE3-256 output).</li>
<li><strong>Inclusion proof:</strong> path bits from <code>k</code> plus sibling hashes per level.</li>
<li><strong>Exclusion proof:</strong> proof of <code>Empty</code> at divergence depth or neighbor leaf.</li>
</ul>
<h3 id="bit-ordering-and-child-semantics">Bit Ordering and Child Semantics<a class="headerlink" href="#bit-ordering-and-child-semantics" title="Permanent link">&para;</a></h3>
<p>To avoid ambiguity, the mapping from bits of the key <code>k</code> to child selection and proof ordering is fixed as follows:</p>
<ul>
<li>Key <code>k</code> is the 256‑bit sha2‑256 multihash digest from the document’s CIDv1.</li>
<li>Define bit indices on <code>k</code> as: bit 0 = least‑significant bit (LSB), bit 255 = most‑significant bit (MSB).</li>
<li>Traversal from root to leaf at tree depth <code>d ∈ [0,255]</code> uses bit <code>(255 − d)</code> of <code>k</code>:<ul>
<li>bit value 0 → go to the left child</li>
<li>bit value 1 → go to the right child</li>
</ul>
</li>
<li>The leftmost leaf corresponds to the path where all 256 bits are 0; the rightmost leaf corresponds to all 1s.</li>
<li>Sibling array ordering in proofs is leaf‑up/LSB‑first:<ul>
<li><code>siblings[0]</code> corresponds to bit 0,</li>
<li><code>siblings[1]</code> to bit 1, …, <code>siblings[255]</code> to bit 255.</li>
</ul>
</li>
<li>Node hashing uses the fixed ordering <code>NodeHash(left, right) = BLAKE3-256(0x01 || left || right)</code>;
  callers MUST pass the left child as the first argument and right child as the second.</li>
</ul>
<p>Implication for <code>.syn</code> prefix buckets: when a requester includes <code>2^D</code> prefix node hashes at depth <code>D</code>,
bucket indices 0..<code>2^D−1</code> correspond to the integer formed by the top <code>D</code> bits of <code>k</code> (MSB‑first).
Thus, the leftmost bucket (index 0) covers keys whose top <code>D</code> bits are all 0; the rightmost bucket
(index <code>2^D−1</code>) covers keys whose top <code>D</code> bits are all 1.</p>
<h3 id="diagram-simplified-smt-proof-path">Diagram — Simplified SMT Proof Path<a class="headerlink" href="#diagram-simplified-smt-proof-path" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>graph TD
  R[Root]
  R --&gt; A
  R --&gt; B
  S0[Sibling hash]:::sib --- A0
  A --&gt; A0
  A --&gt; A1
  A1 --&gt; L["Leaf(k)"]
  classDef sib fill:#FFF3E0,stroke:#FB8C00
  classDef leaf fill:#E8F5E9,stroke:#2E7D32
  S1[Sibling hash]:::sib --- A1
  class L leaf</code></pre>
<h2 id="encrypted-proofs-mandatory-for-prf">Encrypted Proofs (Mandatory for <code>.prf</code>)<a class="headerlink" href="#encrypted-proofs-mandatory-for-prf" title="Permanent link">&para;</a></h2>
<!-- markdownlint-disable MD033 -->
<p><strong>Algorithms (HPKE per RFC 9180 profile):</strong></p>
<ul>
<li>KEM: DHKEM(X25519, HKDF-SHA256)</li>
<li>KDF: HKDF-SHA256</li>
<li>AEAD: ChaCha20-Poly1305</li>
</ul>
<p><strong>Request flow:</strong></p>
<p>Requester generates an ephemeral X25519 key pair and publishes <code>.prv</code> including <code>hpke_pkR</code> (32-byte public key).</p>
<p><strong>Response flow:</strong></p>
<p>Prover derives an HPKE context using <code>hpke_pkR</code>, generates <code>hpke_enc</code> (32-byte encapsulated pub),
and encrypts the proof payload into <code>ct</code>.</p>
<p><strong>Ciphertext AAD binding:</strong></p>
<ul>
<li>The AEAD additional authenticated data MUST be the deterministic CBOR encoding of the array<br>
  <code>[peer-pubkey, seq, ver, in_reply_to]</code>,<br> where <code>peer-pubkey, seq, ver</code> are from the envelope and
  <code>in_reply_to</code> is from the outer payload.<br><br>
  Rationale: Binding to the envelope identity and correlation ID prevents transplanting the ciphertext
  to a different message.
  Root, count, and cid are protected inside the ciphertext (prf-plaintext)
  and validated post-decryption.</li>
</ul>
<p><strong>Verification (requester):</strong></p>
<ol>
<li>Decapsulate with X25519 private key to obtain AEAD key/nonce, then decrypt <code>ct</code> using AAD as above.</li>
<li>Check that <code>kt-responder</code> equals the envelope peer-pubkey and <code>kt-in_reply_to</code> equals the outer in_reply_to and the <code>.prv</code> seq.</li>
<li>Check that <code>kt-cid</code> equals the requested CID from the <code>.prv</code>.</li>
<li>If `kt-present:<ul>
<li><code>true</code>: verify the SMT inclusion proof (<code>kt-proof</code>) against <code>kt-root</code></li>
<li><code>false</code>: verify the non-inclusion proof.</li>
</ul>
</li>
</ol>
<p><strong>Non-requesters cannot decrypt and SHOULD ignore <code>.prf</code> ciphertext.</strong></p>
<!-- markdownlint-enable MD033 -->

<h3 id="diagram-encrypted-proof-exchange-prvprf">Diagram — Encrypted Proof Exchange (.prv/.prf)<a class="headerlink" href="#diagram-encrypted-proof-exchange-prvprf" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>sequenceDiagram
  autonumber
  participant R as Requester
  participant PS as PubSub
  participant V as Prover (Responder)

  Note over R: generate X25519&lt;br&gt;ephemeral (hpke_pkR)
  R-&gt;&gt;PS: .prv [cid, hpke_pkR, provers?]

  PS--&gt;&gt;V: .prv
  Note over V: HPKE seal&lt;br&gt;(hpke_enc, ct = Enc(proof))
  V-&gt;&gt;PS: .prf [in_reply_to, hpke_enc, ct]
  PS--&gt;&gt;R: .prf
  R-&gt;&gt;R: HPKE open(ct) → prf-plaintext

  R-&gt;&gt;R: verify proof vs.&lt;br&gt;decrypted kt-root&lt;br&gt;record</code></pre>
<h3 id="smt-proof-encoding">SMT Proof Encoding<a class="headerlink" href="#smt-proof-encoding" title="Permanent link">&para;</a></h3>
<p><strong>Proofs use numeric keys with named constants (see CDDL):</strong></p>
<table>
<thead>
<tr>
<th>Index</th>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><strong>kp-type</strong></td>
<td>uint</td>
<td>0 = inclusion, 1 = non-inclusion</td>
</tr>
<tr>
<td>2</td>
<td><strong>kp-k</strong></td>
<td>cidv1</td>
<td>The document CID (full cidv1). Verifier derives key <code>k</code> as the sha2-256 multihash digest embedded in this cidv1 (32 bytes).</td>
</tr>
<tr>
<td>3</td>
<td><strong>kp-siblings</strong></td>
<td>array of blake3-256</td>
<td>Ordered from leaf upward (LSB-first)</td>
</tr>
<tr>
<td>4</td>
<td><strong>kp-leaf</strong> (OPTIONAL)</td>
<td>blake3-256</td>
<td>LeafHash; MAY be omitted</td>
</tr>
<tr>
<td>5</td>
<td><strong>kp-depth</strong> (OPTIONAL)</td>
<td>uint</td>
<td>Defaults to 256 if omitted</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> kp-k carries the full cidv1 for clarity.</p>
<p>The key <code>k</code> used in proof verification is its 32-byte sha2-256 multihash digest.
Implementations MUST also ensure <code>kp-k</code> equals the cid carried in the corresponding
<code>.prv</code> request; mismatch is invalid.</p>
<h4 id="cddl-smt-proofs">CDDL — SMT proofs<a class="headerlink" href="#cddl-smt-proofs" title="Permanent link">&para;</a></h4>
<div class="language-cddl highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nc">smt-proof</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span><span class="nc">kp-type</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">uint</span><span class="p">,</span><span class="w">            </span><span class="c1">; 0 incl, 1 excl</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">  </span><span class="nc">kp-k</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">cidv1</span><span class="p">,</span><span class="w">              </span><span class="c1">; document CID; k = sha2-256 digest from this cidv1</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">  </span><span class="nc">kp-siblings</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="o">*</span><span class="w"> </span><span class="nc">blake3-256</span><span class="p">],</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">  </span><span class="o">?</span><span class="w"> </span><span class="nc">kp-leaf</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">blake3-256</span><span class="p">,</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">  </span><span class="o">?</span><span class="w"> </span><span class="nc">kp-depth</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">uint</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="p">}</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="nc">kp-type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="nc">kp-k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="nc">kp-siblings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="nc">kp-leaf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="nc">kp-depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="c1">; self-contained reference</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="nc">cidv1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">bytes</span><span class="w"> </span><span class="ow">.size</span><span class="w"> </span><span class="p">(</span><span class="mi">36</span><span class="o">..</span><span class="mi">40</span><span class="p">)</span><span class="w">  </span><span class="c1">; CIDv1 (binary); multihash MUST be sha2-256 (32-byte digest)</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="nc">blake3-256</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">bytes</span><span class="w"> </span><span class="ow">.size</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="c1">; BLAKE3-256 output</span>
</span></code></pre></div>
<p><strong>Verification procedure (inclusion):</strong></p>
<ol>
<li>Check that <code>proof.k</code> (cidv1) equals the requested cid from <code>.prv</code> or equals the decrypted <code>kt-cid</code>;
   derive <code>k</code> as the sha2-256 multihash digest from this cidv1.</li>
<li>Compute <code>LeafHash</code> using domain separation; iteratively hash with <code>siblings</code> per bit of <code>k</code> to reconstruct a candidate root.</li>
<li>Accept if candidate root equals the decrypted <code>kt-root</code>.</li>
</ol>
<p><strong>Verification procedure (non-inclusion):</strong></p>
<ol>
<li>Either demonstrate a path leading to an <code>Empty</code> node at divergence depth or</li>
<li>provide a neighbor leaf proof whose key differs at the first differing bit.</li>
</ol>
<h2 id="diff-reconciliation">Diff Reconciliation<a class="headerlink" href="#diff-reconciliation" title="Permanent link">&para;</a></h2>
<p><strong>Objective:</strong> Provide the requester with a complete list of CIDs it may be missing relative to the responder’s advertised snapshot,
  with minimal interaction.</p>
<p><strong>Flow:</strong></p>
<ol>
<li>Requester publishes <code>.syn</code> with its current <code>root</code> and <code>count</code> (optionally targeting a specific peer via <code>to</code>).</li>
<li>Responder computes the set of CIDs the requester may be missing relative to its
   own snapshot (the responder’s current <code>root</code>/<code>count</code>).
   Exact determination may rely on local indexes and heuristics; under honest assumptions,
   including all responder-held CIDs suffices for convergence.</li>
<li>If the list is small (≤ 1 MiB when encoded),
   responder MAY include it inline in <code>.dif</code> as <code>missing_for_requester</code>.</li>
<li>Otherwise, responder assembles a diff manifest (see Diff Manifest)
   encoded with deterministic CBOR,
   stores it in IPFS without pinning,
   and replies on <code>.dif</code> with the manifest CID and an intended availability <code>ttl</code>.</li>
<li>Requester fetches the manifest,</li>
<li>pins and inserts any CIDs it does not already have, and</li>
<li>updates its SMT.</li>
</ol>
<p>Further <code>.new</code> or <code>.dif</code> messages will drive it to parity.</p>
<p><strong>Caching:</strong></p>
<p>For a given responder snapshot (<code>root</code>,<code>count</code>), the manifest CID is stable;
responders SHOULD cache and reuse it across solicitations.</p>
<p><strong>Availability:</strong></p>
<p>Responders SHOULD keep manifest blocks available for at least <code>TdiffTTL</code> seconds (default 3600).
Implementations MAY choose to pin temporarily or serve blocks opportunistically.</p>
<p><strong>Rate limiting:</strong>
Responders SHOULD apply jitter and MAY suppress replies if another adequate
<code>.dif</code> is seen for the same <code>.syn</code> to limit redundant manifests.</p>
<p><strong>Prefix depth:</strong></p>
<p>Responders SHOULD select an appropriate depth per the .syn rules above to keep per-bucket sizes ≲ 64 while depth ≤ 14.</p>
<h3 id="diagram-prefix-depth-selection">Diagram — Prefix Depth Selection<a class="headerlink" href="#diagram-prefix-depth-selection" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>flowchart TD
  N[N = responder count] --&gt; X{N &lt;= 64?}
  X -- Yes --&gt; D1[d = 1]
  X -- No --&gt; C1["compute d_req =&lt;br&gt;ceil(log2(N/64))"]
  C1 --&gt; CL["clamp d =&lt;br&gt;min(14, max(1, d_req))"]
  CL --&gt; OUT[d used for bucketization]</code></pre>
<h2 id="diff-manifest-ipfs-object">Diff Manifest (IPFS object)<a class="headerlink" href="#diff-manifest-ipfs-object" title="Permanent link">&para;</a></h2>
<p>Use when inline lists would exceed 1 MiB.</p>
<p>The diff manifest is simply an array of cidv1 values encoded with deterministic CBOR.
Ordering: The array MUST be ordered by the documents’ appearance in the responder’s SMT leaves
from left to right (in-order by path),
ensuring a stable manifest CID for a given snapshot.
It carries no metadata; its context and binding come from the <code>.dif</code> message that references it (which includes any <code>ttl</code>).</p>
<h3 id="cddl-diff-manifest">CDDL — Diff manifest<a class="headerlink" href="#cddl-diff-manifest" title="Permanent link">&para;</a></h3>
<div class="language-cddl highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nc">diff-manifest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">*</span><span class="w"> </span><span class="nc">cidv1</span><span class="p">]</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="nc">cidv1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">bytes</span><span class="w"> </span><span class="ow">.size</span><span class="w"> </span><span class="p">(</span><span class="mi">36</span><span class="o">..</span><span class="mi">40</span><span class="p">)</span><span class="w">  </span><span class="c1">; CIDv1 (binary); multihash MUST be sha2-256 (32-byte digest)</span>
</span></code></pre></div>
<p>Example (decoded):</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>[
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>  h&#39;06f9...cidv1&#39;,
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>  h&#39;07aa...cidv1&#39;,
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>  h&#39;09bc...cidv1&#39;
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>]
</span></code></pre></div>
<h2 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h2>
<ul>
<li>Invalid signature or CBOR not using deterministic encoding: drop.</li>
<li>Oversized message: drop.</li>
<li>Fetch/pin failure: do not insert into SMT; release partial pins from the announcement;
  retain a pending queue and retry within the configured pinning window/policy.</li>
</ul>
<h2 id="security-considerations-poc">Security Considerations (PoC)<a class="headerlink" href="#security-considerations-poc" title="Permanent link">&para;</a></h2>
<ul>
<li>Honest participants assumed; messages are public and unauthenticated beyond per-peer signatures,
  except <code>.prf</code> proof content which is encrypted end-to-end using HPKE as specified.</li>
<li>Implementations SHOULD rate-limit <code>.syn</code> and <code>.dif</code> per peer and bound pin concurrency to avoid resource exhaustion.</li>
</ul>
<h2 id="privacy-considerations-poc">Privacy Considerations (PoC)<a class="headerlink" href="#privacy-considerations-poc" title="Permanent link">&para;</a></h2>
<ul>
<li>None; all fields are public.
  Future versions may add encryption/signing via COSE.</li>
</ul>
<h2 id="observability-and-metrics">Observability and Metrics<a class="headerlink" href="#observability-and-metrics" title="Permanent link">&para;</a></h2>
<ul>
<li>Track: <code>.new</code> seen, pins queued/succeeded/failed, roots observed,
  divergence detected, <code>.syn</code> sent, <code>.dif</code> received,
  diff manifests served/fetched, bytes fetched.</li>
<li>If proof topics enabled: <code>.prv</code> sent/received, <code>.prf</code> verified, proof cache hits.</li>
</ul>
<h2 id="interoperability">Interoperability<a class="headerlink" href="#interoperability" title="Permanent link">&para;</a></h2>
<ul>
<li>Deterministic CBOR encoding is required for all payloads and manifests.</li>
<li>CIDs MUST be CIDv1;</li>
<li>CID arrays MUST contain their binary representations.</li>
<li>PoC CID restriction:<ul>
<li>Document CIDs MUST be CIDv1 with multihash sha2-256 (32-byte digest).</li>
<li>Other multihash functions are not accepted in this version.</li>
</ul>
</li>
<li>SMT hashing MUST be BLAKE3-256 exactly as specified;<ul>
<li>mixing hash functions will produce incompatible roots and proofs.</li>
</ul>
</li>
</ul>
<h2 id="extensibility">Extensibility<a class="headerlink" href="#extensibility" title="Permanent link">&para;</a></h2>
<ul>
<li>New optional fields may be added to payload maps.</li>
<li>Unknown optional fields MUST be ignored.</li>
</ul>
<h2 id="references_1">References<a class="headerlink" href="#references_1" title="Permanent link">&para;</a></h2>
<ul>
<li>Sparse Merkle Trees: RFC 6962 (conceptual), Cosmos ICS23 (proof encoding inspiration).</li>
<li>BLAKE3: O'Connor et al., <a href="https://github.com/BLAKE3-team/BLAKE3">https://github.com/BLAKE3-team/BLAKE3</a> (specification and reference implementations).</li>
<li>Deterministic CBOR: RFC 8949, Sections 4.2.1–4.2.3 (length-first core deterministic encoding).
  Tags MUST appear only when specified by the CDDL; otherwise tags are omitted.</li>
<li>CID/multihash: Document CIDs MUST be CIDv1 with multihash sha2-256 (32-byte digest) in this PoC.
  See <a href="https://github.com/multiformats/cid">https://github.com/multiformats/cid</a> and <a href="https://github.com/multiformats/multihash">https://github.com/multiformats/multihash</a>.</li>
</ul>
<h2 id="open-questions">Open Questions<a class="headerlink" href="#open-questions" title="Permanent link">&para;</a></h2>
<ul>
<li>Numeric defaults (<code>Tmin/Tmax</code>, size caps) may be tuned through experimentation.</li>
<li>Potential future direct-stream optimization for large diffs.</li>
</ul>
<h2 id="glossary">Glossary<a class="headerlink" href="#glossary" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>CID</strong>: IPFS Content Identifier.</li>
<li><strong>CIDv1</strong>: Binary CID version 1; in this spec, multihash MUST be sha2-256 with 32-byte digest.</li>
<li><strong>SMT</strong>: Sparse Merkle Tree (append-only presence set over CIDs).</li>
<li><strong>Root</strong>: SMT root hash summarizing the entire set.</li>
<li><strong>Manifest</strong>: IPFS object (by CID) describing a batch of CIDs or a diff.</li>
<li><strong>UUIDv7</strong>: 128-bit, time-ordered unique identifier used as message/correlation id.</li>
<li><strong>IPFS</strong>: InterPlanetary File System; content-addressed storage and DHT for block exchange.</li>
<li><strong>libp2p</strong>: Modular networking stack used by IPFS (transport, pub/sub, etc.).</li>
<li><strong>DHT</strong>: Distributed Hash Table; used for provider records and content discovery.</li>
<li><strong>Pub/Sub</strong>: Publish/Subscribe messaging; here via libp2p gossipsub (IPFS pubsub).</li>
<li><strong>Gossipsub</strong>: libp2p’s gossip-based pub/sub protocol with topic meshes and scoring.</li>
<li><strong>CBOR</strong>: Concise Binary Object Representation; deterministic encoding required in this spec.</li>
<li><strong>CDDL</strong>: Concise Data Definition Language; used to specify CBOR structures.</li>
<li><strong>HPKE</strong>: Hybrid Public Key Encryption (RFC 9180); used to encrypt <code>.prf</code> proofs end-to-end.</li>
<li><strong>AEAD</strong>: Authenticated Encryption with Associated Data; used within HPKE for proof ciphertexts.</li>
<li><strong>AAD</strong>: Additional Authenticated Data; non-encrypted data bound into AEAD integrity checks.</li>
<li><strong>KEM</strong>: Key Encapsulation Mechanism; HPKE’s public-key component (DHKEM(X25519, HKDF-SHA256)).</li>
<li><strong>KDF</strong>: Key Derivation Function; HPKE uses HKDF-SHA256.</li>
<li><strong>Ed25519</strong>: Edwards-curve digital signature algorithm; used for message signing (64-byte signatures).</li>
<li><strong>X25519</strong>: Diffie–Hellman over Curve25519; used for HPKE key exchange.</li>
<li><strong>BLAKE3-256</strong>: Hash function used for SMT NodeHash/LeafHash (32-byte output).</li>
<li><strong>sha2-256</strong>: Multihash function used inside CIDv1 (32-byte digest) to derive SMT key <code>k</code>.</li>
<li><strong>ChaCha20-Poly1305</strong>: AEAD cipher used by the HPKE profile in this spec.</li>
<li><strong>TTL</strong>: Time To Live; duration responders keep diff manifests available when <code>manifest</code> is used.</li>
<li><strong>QoS</strong>: Quality of Service; topic separation allows independent prioritization/backpressure per topic.</li>
<li><strong>PoC</strong>: Proof of Concept; indicates provisional choices and scope limits for this draft.</li>
</ul>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      (c) 2023 Input Output Global Ltd.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  


<h4>Cookie consent</h4>
<p>
We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
      
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="github" checked>
      <span class="task-list-indicator"></span>
      GitHub
    </label>
  </li>

      
    
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.path", "navigation.indexes", "toc.follow", "toc.integrate", "search.suggest", "search.highlight", "content.code.copy", "content.tooltips"], "search": "../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": {"ADR": "adr", "CSS": "css", "Dart": "dart", "Docker": "docker", "Earthly": "earthly", "Flutter": "flutter", "Github": "github", "HTML5": "html", "JavaScript": "js", "Python": "python", "Rust": "rust", "arc42": "arc42"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="../../../../assets/javascripts/massilia-graphviz.js"></script>
      
        <script src="../../../../assets/javascripts/mathjax.js"></script>
      
        <script src="../../../../assets/javascripts/tex-mml-chtml.js"></script>
      
        <script src="../../../../search/main.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>