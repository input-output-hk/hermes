# Docker Compose for Hermes P2P Testing
# Simulates multiple computers running Hermes with isolated networks

services:
  hermes-node1:
    build:
      context: ..
      dockerfile: p2p-testing/Dockerfile
    container_name: hermes-node1
    hostname: node1
    environment:
      - HERMES_HTTP_PORT=5000
      - HERMES_ACTIVATE_AUTH=true
      - REDIRECT_ALLOWED_HOSTS=app.dev.projectcatalyst.io
      - REDIRECT_ALLOWED_PATH_PREFIXES=/api/gateway/v1/config/frontend,/api/gateway/v1/cardano/assets,/api/gateway/v1/rbac/registration
    ports:
      # HTTP Gateway
      - "5000:5000"
      # IPFS Swarm (P2P)
      - "4001:4001"
      # IPFS API
      - "5001:5001"
    volumes:
      - node1-data:/data
    networks:
      hermes-p2p:
        ipv4_address: 172.20.0.10

  hermes-node2:
    build:
      context: ..
      dockerfile: p2p-testing/Dockerfile
    container_name: hermes-node2
    hostname: node2
    environment:
      - HERMES_HTTP_PORT=5000
      - HERMES_ACTIVATE_AUTH=true
      - REDIRECT_ALLOWED_HOSTS=app.dev.projectcatalyst.io
      - REDIRECT_ALLOWED_PATH_PREFIXES=/api/gateway/v1/config/frontend,/api/gateway/v1/cardano/assets,/api/gateway/v1/rbac/registration
    ports:
      # HTTP Gateway (different host port)
      - "5002:5000"
      # IPFS Swarm
      - "4002:4001"
      # IPFS API
      - "5003:5001"
    volumes:
      - node2-data:/data
    networks:
      hermes-p2p:
        ipv4_address: 172.20.0.11

  hermes-node3:
    build:
      context: ..
      dockerfile: p2p-testing/Dockerfile
    container_name: hermes-node3
    hostname: node3
    environment:
      - HERMES_HTTP_PORT=5000
      - HERMES_ACTIVATE_AUTH=true
      - REDIRECT_ALLOWED_HOSTS=app.dev.projectcatalyst.io
      - REDIRECT_ALLOWED_PATH_PREFIXES=/api/gateway/v1/config/frontend,/api/gateway/v1/cardano/assets,/api/gateway/v1/rbac/registration
    ports:
      # HTTP Gateway (different host port)
      - "5004:5000"
      # IPFS Swarm
      - "4003:4001"
      # IPFS API
      - "5005:5001"
    volumes:
      - node3-data:/data
    networks:
      hermes-p2p:
        ipv4_address: 172.20.0.12

networks:
  hermes-p2p:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16

volumes:
  node1-data:
  node2-data:
  node3-data:
